(function(t){function e(e){for(var i,s,o=e[0],l=e[1],c=e[2],d=0,p=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&p.push(n[s][0]),n[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);h&&h(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var i={},n={app:0},r=[];function s(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=i,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var h=l;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var i=a("85ec"),n=a.n(i);n.a},1:function(t,e){},"16b7":function(t,e,a){},"2e8d":function(t,e,a){},"312f":function(t,e,a){"use strict";var i=a("c6b8"),n=a.n(i);n.a},"3b4f":function(t,e,a){"use strict";var i=a("b886"),n=a.n(i);n.a},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"1400px"},attrs:{id:"app"}},[t._m(0),a("div",{staticClass:"container-fluid",staticStyle:{"padding-left":"5px","padding-right":"5px"}},[a("div",{staticClass:"row",staticStyle:{"margin-left":"10px","margin-right":"10px"}},[a("div",{staticClass:"col-3 content",staticStyle:{"padding-left":"3px","padding-right":"3px"}},[a("RelationView",{attrs:{videoId:t.videoId,videoData:t.videoData}})],1),a("div",{staticClass:"col-6 content",staticStyle:{"padding-left":"3px","padding-right":"3px"}},[a("MatrixView",{attrs:{videoId:t.videoId,videoData:t.videoData}})],1),a("div",{staticClass:"col-3 content",staticStyle:{"padding-left":"3px","padding-right":"3px"}},[a("VideoView",{attrs:{videoList:t.videoList,videoId:t.videoId,videoData:t.videoData}}),a("DynamicView",{attrs:{videoId:t.videoId,videoData:t.videoData}})],1)])])])},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{staticClass:"navbar sticky-top navbar-dark bg-dark",staticStyle:{"padding-top":"1px","padding-bottom":"1px","margin-bottom":"5px"}},[a("div",{staticStyle:{"margin-top":"5px","margin-left":"15px"}},[a("span",{staticStyle:{color:"white","font-size":"1.25rem","font-weight":"500","user-select":"none"}},[t._v("GestureLens: Visual Analysis of Gesture in Presentation Videos")])])])}],s=new i["default"]({data:{COLLECTION2VIDEO:"collection_2_video",SELECTVIDEO:"select_video",VISIONDATA:"vision_data",AUDIODATA:"audio_data",TEXTDATA:"text_data",FRAMETIME:"frame_time",FRAMESELECTEDFROMVIDEO:"frame_selected_from_video",FRAMESELECTEDFROMTIMEBAR:"frame_selected_from_timebar",FRAMESELECTEDFROMANIMATION:"frame_selected_from_animation",FRAMEBRUSH:"frame_brush",GESTUREPHASE:"gesture_phase",SEEKFROMPHASE:"seek_from_phase",REVIEWERNAME:"reviewer_name",GESTUREPARAMETER:"gesture_parameter",SELECTEDPHASE:"selected_phase",SELECTEDSENTENCE:"selected_sentence",UPDATETIMEFRAME:"update_time_frame",UPDATETIMERANGE:"update_time_range",SEARCHSENTENCE:"search_sentence",UPDATETEXTLIST:"update_text_list",UPDATEMOVEMENTDATA:"update_movement_data",CLICKFROMTEXTLIST:"click_from_textlist",UPDATETIMELINEMARKER:"update_timeline_marker",UPDATEDYNAMICMOVEMENT:"update_dynamic_movement",TEXTSHOWGESTURE:"text_show_gesture",MATCHWORD:"match_word",HIGHLIGHTTEXT:"highlight_text",HIGHLIGHTWORD:"highlight_word",SHOWSTOPWORD:"show_stop_word",RUNCLUSTER:"run_cluster",SORTMODE:"sort_mode",HIGHLIGHTGLYPH:"highlight_glyph",TIMEFILTER:"time_filter",NUMFILTER:"num_filter",LEGENDFILTER:"legend_filter",HIGHLIGHTPOINT:"highlight_point",ANIMATIONFRAMEFROMVIDEO:"animation_frame_from_video",PLAYVIDEOFROMSLIDER:"play_video_from_slider",VIDEOFRAMEFROMSLIDER:"video_frame_from_slider"},methods:{emitCollection2Video:function(t){this.$emit(this.COLLECTION2VIDEO,t)},onCollection2Video:function(t){this.$on(this.COLLECTION2VIDEO,(function(e){t(e)}))},emitSelectVideo:function(t){this.$emit(this.SELECTVIDEO,t)},onSelectVideo:function(t){this.$on(this.SELECTVIDEO,(function(e){t(e)}))},emitVisionData:function(t){this.$emit(this.VISIONDATA,t)},onVisionData:function(t){this.$on(this.VISIONDATA,(function(e){t(e)}))},emitAudioData:function(t){this.$emit(this.AUDIODATA,t)},onAudioData:function(t){this.$on(this.AUDIODATA,(function(e){t(e)}))},emitTextData:function(t){this.$emit(this.TEXTDATA,t)},onTextData:function(t){this.$on(this.TEXTDATA,(function(e){t(e)}))},emitFrameTime:function(t){this.$emit(this.FRAMETIME,t)},onFrameTime:function(t){this.$on(this.FRAMETIME,(function(e){t(e)}))},emitFrameSelectedFromVideo:function(t){this.$emit(this.FRAMESELECTEDFROMVIDEO,t)},onFrameSelectedFromVideo:function(t){this.$on(this.FRAMESELECTEDFROMVIDEO,(function(e){t(e)}))},emitFrameSelectedFromTimeBar:function(t){this.$emit(this.FRAMESELECTEDFROMTIMEBAR,t)},onFrameSelectedFromTimeBar:function(t){this.$on(this.FRAMESELECTEDFROMTIMEBAR,(function(e){t(e)}))},emitFrameBrush:function(t){this.$emit(this.FRAMEBRUSH,t)},onFrameBrush:function(t){this.$on(this.FRAMEBRUSH,(function(e){t(e)}))},emitGesturePhase:function(t){this.$emit(this.GESTUREPHASE,t)},onGesturePhase:function(t){this.$on(this.GESTUREPHASE,(function(e){t(e)}))},emitSeekFromPhase:function(t){this.$emit(this.SEEKFROMPHASE,t)},onSeekFromPhase:function(t){this.$on(this.SEEKFROMPHASE,(function(e){t(e)}))},emitReviewerName:function(t){this.$emit(this.REVIEWERNAME,t)},onReviewerName:function(t){this.$on(this.REVIEWERNAME,(function(e){t(e)}))},emitGestureParameter:function(t){this.$emit(this.GESTUREPARAMETER,t)},onGestureParameter:function(t){this.$on(this.GESTUREPARAMETER,(function(e){t(e)}))},emitSelectedPhase:function(t){this.$emit(this.SELECTEDPHASE,t)},onSelectedPhase:function(t){this.$on(this.SELECTEDPHASE,(function(e){t(e)}))},emitSelectedSentence:function(t){this.$emit(this.SELECTEDSENTENCE,t)},onSelectedSentence:function(t){this.$on(this.SELECTEDSENTENCE,(function(e){t(e)}))},emitUpdateTimeFrame:function(t){this.$emit(this.UPDATETIMEFRAME,t)},onUpdateTimeFrame:function(t){this.$on(this.UPDATETIMEFRAME,(function(e){t(e)}))},emitUpdateTimeRange:function(t){this.$emit(this.UPDATETIMERANGE,t)},onUpdateTimeRange:function(t){this.$on(this.UPDATETIMERANGE,(function(e){t(e)}))},emitSearchSentence:function(t){this.$emit(this.SEARCHSENTENCE,t)},onSearchSentence:function(t){this.$on(this.SEARCHSENTENCE,(function(e){t(e)}))},emitUpdateTextList:function(t){this.$emit(this.UPDATETEXTLIST,t)},onUpdateTextList:function(t){this.$on(this.UPDATETEXTLIST,(function(e){t(e)}))},emitUpdateMovementData:function(t){this.$emit(this.UPDATEMOVEMENTDATA,t)},onUpdateMovementData:function(t){this.$on(this.UPDATEMOVEMENTDATA,(function(e){t(e)}))},emitClickFromTextlist:function(t){this.$emit(this.CLICKFROMTEXTLIST,t)},onClickFromTextlist:function(t){this.$on(this.CLICKFROMTEXTLIST,(function(e){t(e)}))},emitUpdateTimelineMarker:function(t){this.$emit(this.UPDATETIMELINEMARKER,t)},onUpdateTimelineMarker:function(t){this.$on(this.UPDATETIMELINEMARKER,(function(e){t(e)}))},emitUpdateDynamicMovement:function(t){this.$emit(this.UPDATEDYNAMICMOVEMENT,t)},onUpdateDynamicMovement:function(t){this.$on(this.UPDATEDYNAMICMOVEMENT,(function(e){t(e)}))},emitTextShowGesture:function(t){this.$emit(this.TEXTSHOWGESTURE,t)},onTextShowGesture:function(t){this.$on(this.TEXTSHOWGESTURE,(function(e){t(e)}))},emitMatchWord:function(t){this.$emit(this.MATCHWORD,t)},onMatchWord:function(t){this.$on(this.MATCHWORD,(function(e){t(e)}))},emitHighlightText:function(t){this.$emit(this.HIGHLIGHTTEXT,t)},onHighlightText:function(t){this.$on(this.HIGHLIGHTTEXT,(function(e){t(e)}))},emitHighlightWord:function(t){this.$emit(this.HIGHLIGHTWORD,t)},onHighlightWord:function(t){this.$on(this.HIGHLIGHTWORD,(function(e){t(e)}))},emitStopWord:function(t){this.$emit(this.SHOWSTOPWORD,t)},onStopWord:function(t){this.$on(this.SHOWSTOPWORD,(function(e){t(e)}))},emitRunCluster:function(t){this.$emit(this.RUNCLUSTER,t)},onRunCluster:function(t){this.$on(this.RUNCLUSTER,(function(e){t(e)}))},emitSortMode:function(t){this.$emit(this.SORTMODE,t)},onSortMode:function(t){this.$on(this.SORTMODE,(function(e){t(e)}))},emitHighlightGlyph:function(t){this.$emit(this.HIGHLIGHTGLYPH,t)},onHighlightGlyph:function(t){this.$on(this.HIGHLIGHTGLYPH,(function(e){t(e)}))},emitTimeFilter:function(t){this.$emit(this.TIMEFILTER,t)},onTimeFilter:function(t){this.$on(this.TIMEFILTER,(function(e){t(e)}))},emitNumFilter:function(t){this.$emit(this.NUMFILTER,t)},onNumFilter:function(t){this.$on(this.NUMFILTER,(function(e){t(e)}))},emitLegendFilter:function(t){this.$emit(this.LEGENDFILTER,t)},onLegendFilter:function(t){this.$on(this.LEGENDFILTER,(function(e){t(e)}))},emitHighlightPoint:function(t){this.$emit(this.HIGHLIGHTPOINT,t)},onHighlightPoint:function(t){this.$on(this.HIGHLIGHTPOINT,(function(e){t(e)}))},emitFrameSelectedFromAnimation:function(t){this.$emit(this.FRAMESELECTEDFROMANIMATION,t)},onFrameSelectedFromAnimation:function(t){this.$on(this.FRAMESELECTEDFROMANIMATION,(function(e){t(e)}))},emitAnimationFrameFromVideo:function(t){this.$emit(this.ANIMATIONFRAMEFROMVIDEO,t)},onAnimationFrameFromVideo:function(t){this.$on(this.ANIMATIONFRAMEFROMVIDEO,(function(e){t(e)}))},emitPlayVideoFromSlider:function(t){this.$emit(this.PLAYVIDEOFROMSLIDER,t)},onPlayVideoFromSlider:function(t){this.$on(this.PLAYVIDEOFROMSLIDER,(function(e){t(e)}))},emitVideoFrameFromSlider:function(t){this.$emit(this.VIDEOFRAMEFROMSLIDER,t)},onVideoFrameFromSlider:function(t){this.$on(this.VIDEOFRAMEFROMSLIDER,(function(e){t(e)}))}}}),o=s,l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"videoview"}},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-header"},[t._m(0),a("div",{staticStyle:{float:"right","margin-right":"5px"}},[a("span",{staticStyle:{"user-select":"none"}},[t._v("Video: ")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedVideo,expression:"selectedVideo"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedVideo=e.target.multiple?a:a[0]}}},[a("option",{attrs:{disabled:"",value:""}},[t._v("select")]),a("option",{attrs:{disabled:!t.ReviewerNameFlag,value:"demoVideo"}},[t._v("Video 1")])])]),t._m(1)]),a("div",{staticClass:"card-block",attrs:{id:"videoPlayerContainer"}},[a("div",{staticStyle:{height:"318px"}},[a("video",{ref:"videoView",staticClass:"video-js vjs-big-play-centered",attrs:{id:"my-player",crossorigin:"anonymous",width:"333.5px",height:"188px"}}),a("div",{attrs:{id:"labelsContainer"}})]),a("div",{attrs:{id:"videoScreenshot"}})])])])},c=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left","margin-left":"20px","margin-top":"3px"}},[a("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Video View")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"right","margin-right":"15px"}},[a("button",{attrs:{id:"cameraButton"}},[a("span",{staticClass:"fa fa-camera"})])])}],h=(a("6b54"),a("ac6a"),a("456d"),a("28a5"),a("f0e2")),d={width:730,height:1446,points:{0:[381.6,116],1:[388.5,310],2:[250,307.7],3:[176,508.7],4:[92.9,681.9],5:[524.8,307.7],6:[578.5,513.4],7:[616.7,716.7],8:[377.5,711.9],9:[286.6,702.3],10:[277,1001.4],11:[248.3,1295.6],12:[461.2,716.7],13:[468.4,1008.6],14:[475.6,1302.8],15:[348.8,87.54],16:[401.4,87.5],17:[317.7,125.8],18:[444.5,128.2],19:[509.1,1386.5],20:[540.2,1365],21:[454.1,1329.1],22:[217.2,1391.3],23:[188.5,1372.2],24:[272.2,1314.8]}},p=[(d.points[1][0]+d.points[8][0])/2,(d.points[1][1]+d.points[8][1])/2],u=Math.abs(d.points[8][1]-d.points[1][1])/2,m=u/2,f=Math.abs(p[1]-d.points[0][1]),g={centerCenter:{left:p[0]-m,top:p[1]-m,width:2*m,height:2*m},center:{left:p[0]-u,top:p[1]-u,width:2*u,height:2*u},periphery:{left:p[0]-f,top:p[1]-f,width:2*f,height:2*f},extremePeriphery:{left:p[0]-f-150,top:p[1]-f-150,width:2*f+300,height:2*f+300}},v=[[0,1],[0,15],[0,16],[15,17],[16,18],[1,2],[2,3],[3,4],[1,5],[5,6],[6,7],[1,8],[8,9],[9,10],[10,11],[11,22],[11,24],[22,23],[8,12],[12,13],[13,14],[14,21],[14,19],[19,20]],y=[[0,1],[1,2],[1,5],[2,3],[3,4],[5,6],[6,7]],x=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20]],S={VERB:"#359F2C",NOUN:"#2178B4",PRON:"#B25928",ADJ:"#FB9A99",ADV:"#E41A1C",ADP:"#6B3D9A",CONJ:"#FF7F02",DET:"#CAB2D7",NUM:"#FFDE09",PRT:"#A6CFE3",X:"#B3DF8A",".":"#FDC06F"},w={NP:"#FCB4AF",PP:"#CCEBC6",VP:"#FEDAA6",SVO:"#DECBE5",EN:"#b3cde3",ADJ:"#9ecae1"},k={noun_phrases:"NP",entities:"EN",prepositional_phrases:"PP",subject_verb_object:"SVO",verb_phrases:"VP",adj_tokens:"ADJ"},T={NP:"noun_phrases",EN:"entities",PP:"prepositional_phrases",SVO:"subject_verb_object",VP:"verb_phrases",ADJ:"adj_tokens"},D={open:"#fb8072",closed:"#80b1d3",others:"#b9b9b9"},b="#f1a340",I="#998ec3",P="bob_inglis_american_bipartisan_politics_can_be_saved_here_s_how",E={videoId:P,projectionFileName:"".concat(P,"-haipeng-0.3-10-20")},F={skeletonInit:d,centerPoint:p,gestureSpace:g,BODY25Pairs:v,UPBODYPairs:y,handPairs:x,POSColor:S,PhraseColor:w,PhraseMapping:k,PhraseMappingReverse:T,gestureTypeColor:D,leftHandColor:b,rightHandColor:I,fileConfig:E},M=function(t){this.svgWidth=$(t).width(),this.svgHeight=$(t).height(),this.refreshIntervalId=-1,this.refreshAnimation=-1;var e=d3.timeFormat("%M:%S");this.formatMinutes=function(t){return e(new Date(2017,0,1,0,0,t))},this.setupVideo("my-player"),this.screenshotList=[],this.screenshotIdx=0;var a=this,i="",n="",r=.2,s=function(){n=d3.select("#videoScreenshot").append("div").style("width","333px").style("height","114px").style("overflow","scroll").style("float","left").style("white-space","nowrap"),i=$("#my-player_html5_api").get(0),$("#cameraButton").click(o)},o=function(){var t=new Image;t.crossOrigin="*";var e="",s=document.createElement("canvas");s.width=i.videoWidth*r,s.height=i.videoHeight*r,s.getContext("2d").drawImage(i,0,0,s.width,s.height),e=s.toDataURL("image/jpeg"),t.src=e;var o=n.append("div").attr("id","screenshot-"+a.screenshotIdx).attr("class","imageContainer").style("margin","15px 5px 10px 5px").style("position","relative").style("display","inline-block");o.append("img").attr("id","img-"+a.screenshotIdx).style("width",.08*i.videoWidth+"px").style("height",.08*i.videoHeight+"px").attr("src",e).on("click",(function(){for(var t=d3.select(this)["_groups"][0][0]["id"],e=t.split("-")[1],i=0;i<a.screenshotList.length;i++)a.screenshotList[i]["idx"]==e&&a.myPlayer.currentTime(a.screenshotList[i]["curTime"])})),o.append("img").attr("id","delete-"+a.screenshotIdx).attr("src","/image/delete.png").attr("width",20).attr("height",20).style("position","absolute").style("right","-5px").style("top","-5px").style("opacity",0).style("pointer-events","all").on("mouseover",(function(){d3.select(this).style("opacity",1)})).on("mouseout",(function(){d3.select(this).style("opacity",0)})).on("click",(function(){d3.select(this.parentNode).remove(),d3.select(this).remove()}));var l=a.myPlayer.currentTime();a.curTimeToLabeledFrame(l);var c=a.frameIdxList[a.arrayIdx];a.screenshotList.push({dataURL:e,idx:a.screenshotIdx,frame:c,curTime:l}),a.screenshotIdx+=1,o.append("text").style("position","absolute").style("left","38px").style("bottom","-20px").style("font-size","12px").style("text-anchor","middle").text(a.formatMinutes(l));for(var h="",d=0;d<a.textData.length;d++)if("punctuation"!=a.textData[d]["type"]){if(l<parseFloat(a.textData[d]["start_time"]))break;if(l>=parseFloat(a.textData[d]["start_time"])&&l<=parseFloat(a.textData[d]["end_time"])){h=a.textData[d]["word"];break}}o.append("text").style("position","absolute").style("left","".concat(50-1.8*h.length,"px")).style("bottom","-35px").style("font-size","12px").attr("text-anchor","middle").text(h)};s()};M.prototype.setupVideo=function(t){var e=this,a=this;this.myPlayer=Object(h["a"])(t,{controls:!0,autoplay:!1,preload:"auto",language:"en",playbackRates:[.2,.5,1,1.5,2,3,4,5],inactivityTimeout:0,height:this.svgHeight,width:this.svgWidth}),o.onSeekFromPhase((function(t){e.startTime=e.seekTimeList[t["startFrameIdx"]],e.endTime=e.seekTimeList[t["endFrameIdx"]],e.myPlayer.currentTime(e.startTime),e.myPlayer.on("timeupdate",(function(){a.myPlayer.currentTime()>=a.endTime&&(a.myPlayer.pause(),a.endTime=a.seekTimeList[a.seekTimeList.length-1])})),e.myPlayer.play()})),o.onClickFromTextlist((function(t){e.startTime=e.seekTimeList[t[0]-5],e.endTime=e.seekTimeList[t[1]+5],e.myPlayer.currentTime(e.startTime),e.myPlayer.on("timeupdate",(function(){a.myPlayer.currentTime()>=a.endTime&&(a.myPlayer.pause(),a.endTime=a.seekTimeList[a.seekTimeList.length-1])})),e.myPlayer.play()})),o.onPlayVideoFromSlider((function(t){var i=t["frameSelection"];if("pause"==t["status"])e.myPlayer.pause();else{var n=a.myPlayer.currentTime();a.curTimeToLabeledFrame(n);var r=a.frameIdxList[a.arrayIdx];if(i[0]<=r&&r<=i[1])e.myPlayer.play();else{var s=d3.bisector((function(t){return t})).left;r=i[0];var o=s(e.frameIdxList,r);e.seekTime=e.seekTimeList[o],e.arrayIdx=o,e.myPlayer.currentTime(e.seekTime),e.myPlayer.play()}}})),o.onVideoFrameFromSlider((function(t){var a=d3.bisector((function(t){return t})).left,i=a(e.frameIdxList,t);e.seekTime=e.seekTimeList[i],e.arrayIdx=i,e.myPlayer.currentTime(e.seekTime)})),this.myPlayer.ready((function(){a.myPlayer.pause(),a.myPlayer.currentTime(0),a.myPlayer.on("ended",(function(){})),a.myPlayer.on("pause",(function(){clearInterval(a.refreshIntervalId),clearInterval(a.refreshAnimation);var t=a.myPlayer.currentTime();a.curTimeToLabeledFrame(t),a.updateDrawingLabelPoses(a.arrayIdx)})),a.myPlayer.on("play",(function(){a.myPlayer.currentTime()>a.endTime&&a.myPlayer.pause(),a.removeDrawingLabelPoses(),a.refreshIntervalId=setInterval((function(){var t=a.myPlayer.currentTime();a.curTimeToLabeledFrame(t),o.emitFrameSelectedFromVideo(a.arrayIdx)}),500),a.refreshAnimation=setInterval((function(){var t=a.myPlayer.currentTime();a.curTimeToLabeledFrame(t),o.emitAnimationFrameFromVideo(a.frameIdxList[a.arrayIdx])}),100)})),a.myPlayer.on("seeking",(function(){var t=parseFloat(a.myPlayer.currentTime().toFixed(2));t!==a.seekTime&&(a.curTimeToLabeledFrame(t),a.myPlayer.currentTime(a.seekTime)),a.myPlayer.paused()?a.updateDrawingLabelPoses(a.arrayIdx):a.removeDrawingLabelPoses()}))})),o.onFrameSelectedFromTimeBar((function(t){a.arrayIdx=t,a.seekFrame=a.frameIdxList[t],a.seekTime=a.seekTimeList[t],a.myPlayer.currentTime(a.seekTime)})),o.onFrameSelectedFromAnimation((function(t){var i=d3.bisector((function(t){return t})).left,n=i(e.frameIdxList,t);e.seekTime=e.seekTimeList[n],a.arrayIdx=n,a.myPlayer.currentTime(a.seekTime)}))},M.prototype.updateVideo=function(t){var e=this;function a(){e.endTime=e.myPlayer.duration()}this.myPlayer.src({type:"video/mp4",src:t}),e.myPlayer.on("click",(function(){e.myPlayer.readyState()<1?e.myPlayer.one("loadedmetadata",a):a()}))},M.prototype.layout=function(t,e,a){var i=this;this.visionData=e,this.videoInfo=this.visionData["videoInfo"],this.poseData=this.visionData["poseData"],this.faceData=this.visionData["faceData"],this.textData=this.visionData["stickmanData"]["textData"],d3.select(t).selectAll("*").remove(),this.videoHeight=this.videoInfo["videoHeight"],this.videoWidth=this.videoInfo["videoWidth"],this.fps=this.videoInfo["fps"],this.myPlayer.src({type:"video/mp4",src:a});var n=this.svgWidth/this.svgHeight,r=this.videoWidth/this.videoHeight;r>n?(this.videoScreenWidth=this.svgWidth,this.videoScreenHeight=this.svgWidth/r):(this.videoScreenHeight=this.svgHeight,this.videoScreenWidth=this.svgHeight*r);var s=(this.svgWidth-this.videoScreenWidth)/2,o=(this.svgHeight-this.videoScreenHeight)/2;this.margin={top:o,right:s,bottom:o,left:s},this.svg=d3.select(t).append("svg").attr("class","videoSvg").attr("height",this.svgHeight).attr("width",this.svgWidth),this.graphContainer=this.svg.append("g").attr("class","g_main").attr("transform","translate("+this.margin.left+", "+this.margin.top+")"),this.labeledFrameIndex=-1,this.rectBdHighlightClr="#ff0000",this.rectBdNormalClr="#00ff00",this.rectBdWarningClr="yellow";var l=1;this.arrayIdx=0,this.seekTime=0,this.frameIdxList=d3.range(0,this.videoInfo["totalFrmNum"],l),this.seekTimeList=this.frameIdxList.map((function(t){return parseFloat((1*t/i.fps).toFixed(2))}))},M.prototype.removeDrawingLabelPoses=function(){this.graphContainer.selectAll("*").remove()},M.prototype.updateDrawingLabelPoses=function(t){this.removeDrawingLabelPoses();var e=this;if(o.emitFrameSelectedFromVideo(t),void 0!==this.faceData&&0!==this.faceData.length){var a=this.faceData[t];if(0===a.length?console.log("===========",t):this.graphContainer.append("g").attr("class","peopleface").selectAll("g").data(a).enter().append("g").attr("class",(function(){return"person_".concat(t)})).attr("transform",(function(t){var a=t["position"][0]*e.videoScreenWidth,i=t["position"][1]*e.videoScreenHeight;return"translate(".concat(a,", ").concat(i,")")})).each(r),void 0!==this.poseData&&0!==Object.keys(this.poseData).length){var i=this.poseData[t.toString()],n=i["people"];0!==n.length?this.graphContainer.append("g").attr("class","poseInfo").selectAll("g").attr("class","peoplePoseInfo").data(n).enter().append("g").attr("class",(function(){return"people_".concat(t)})).each((function(t){for(var a=25,i=21,n=t["pose_keypoints_2d"],r=t["hand_left_keypoints_2d"],s=t["hand_right_keypoints_2d"],o=[],l=[],c=[],h=0;h<a;h++)o.push([n[3*h]/e.videoWidth,n[3*h+1]/e.videoHeight,n[3*h+2]]);for(var d=0;d<i;d++)l.push([r[3*d]/e.videoWidth,r[3*d+1]/e.videoHeight,r[3*d+2]]),c.push([s[3*d]/e.videoWidth,s[3*d+1]/e.videoHeight,s[3*d+2]]);d3.select(this).append("g").attr("class","bodyPoints").selectAll("cirlce").data(o.filter((function(t){return 0!==t[2]}))).enter().append("circle").attr("cx",(function(t){return t[0]*e.videoScreenWidth})).attr("cy",(function(t){return t[1]*e.videoScreenHeight})).attr("r",2).style("fill","red");var p=F.BODY25Pairs.map((function(t){return 0!==o[t[0]][2]&&0!==o[t[1]][2]?t:null})).filter((function(t){return t}));d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(p).enter().append("line").attr("x1",(function(t){return o[t[0]][0]*e.videoScreenWidth})).attr("y1",(function(t){return o[t[0]][1]*e.videoScreenHeight})).attr("x2",(function(t){return o[t[1]][0]*e.videoScreenWidth})).attr("y2",(function(t){return o[t[1]][1]*e.videoScreenHeight})).style("stroke","#bdbdbd").style("stroke-width",2),d3.select(this).append("g").attr("class","leftHandPoints").selectAll("cirlce").data(l.filter((function(t){return 0!==t[2]}))).enter().append("circle").attr("cx",(function(t){return t[0]*e.videoScreenWidth})).attr("cy",(function(t){return t[1]*e.videoScreenHeight})).attr("r",2).style("fill",F.leftHandColor);var u=F.handPairs.map((function(t){return 0!==l[t[0]][2]&&0!==l[t[1]][2]?t:null})).filter((function(t){return t}));d3.select(this).append("g").attr("class","lefthand-point-connection").selectAll("line").data(u).enter().append("line").attr("x1",(function(t){return l[t[0]][0]*e.videoScreenWidth})).attr("y1",(function(t){return l[t[0]][1]*e.videoScreenHeight})).attr("x2",(function(t){return l[t[1]][0]*e.videoScreenWidth})).attr("y2",(function(t){return l[t[1]][1]*e.videoScreenHeight})).style("stroke",F.leftHandColor).style("stroke-width",2),d3.select(this).append("g").attr("class","rightHandPoints").selectAll("cirlce").data(c.filter((function(t){return 0!==t[2]}))).enter().append("circle").attr("cx",(function(t){return t[0]*e.videoScreenWidth})).attr("cy",(function(t){return t[1]*e.videoScreenHeight})).attr("r",2).style("fill",F.rightHandColor);var m=F.handPairs.map((function(t){return 0!==c[t[0]][2]&&0!==c[t[1]][2]?t:null})).filter((function(t){return t}));d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(m).enter().append("line").attr("x1",(function(t){return c[t[0]][0]*e.videoScreenWidth})).attr("y1",(function(t){return c[t[0]][1]*e.videoScreenHeight})).attr("x2",(function(t){return c[t[1]][0]*e.videoScreenWidth})).attr("y2",(function(t){return c[t[1]][1]*e.videoScreenHeight})).style("stroke",F.rightHandColor).style("stroke-width",2)})):console.log("no people, arrayIdx: ",t)}else console.log("====No pose for the whole video===== ")}function r(t){var a=t["position"][2]*e.videoScreenWidth,i=t["position"][3]*e.videoScreenHeight;d3.select(this).append("rect").attr("width",a).attr("height",i).style("fill","red").style("fill-opacity",0).style("fill","pink").style("stroke",e.rectBdNormalClr).style("stroke-width",2),d3.select(this).append("text").attr("x",0).attr("y",-35).attr("dy","2em").text((function(){return t["emotion"]})).attr("font-family","sans-serif").attr("font-size","8px").attr("fill","white").style("text-anchor","left")}},M.prototype.curTimeToLabeledFrame=function(t){var e=d3.bisector((function(t){return t})).left,a=e(this.seekTimeList,t);return this.seekTime=this.seekTimeList[a],this.arrayIdx=a,{seekTime:this.seekTime}};var C=M,A={name:"VideoView",components:{},props:{videoList:Array,videoId:String,videoData:Object},data:function(){return{videoUrlList:[],selectedVideo:"",poseData:{},frameIdx:0,ReviewerNameFlag:!0}},watch:{selectedVideo:function(t){this.selectedVideo=t,""!==this.selectedVideo&&o.emitSelectVideo(this.selectedVideo)},videoData:function(t){var e="/data/".concat(this.videoId,".mp4");this.drawVideo.layout("#labelsContainer",t,e)},frameIdx:function(t){this.drawVideo.updateDrawingLabelPoses(t)}},methods:{},mounted:function(){this.drawVideo=new C("#labelsContainer")}},H=A,R=(a("ad17"),a("2877")),L=Object(R["a"])(H,l,c,!1,null,"16f0a882",null),_=L.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"matrixview"}},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-header"},[t._m(0),t._m(1),t._m(2),a("div",{staticStyle:{float:"right","margin-top":"0px","margin-right":"1px"}},[a("label",{attrs:{for:"toggle"}},[t._v("Gesture: ")]),a("toggle-button",{attrs:{value:t.gestureToggled},on:{change:function(e){t.gestureToggled=e.value}}})],1)]),a("div",{staticClass:"card-block",attrs:{id:"matrixContainer"}})])])},N=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left","margin-left":"20px","margin-top":"3px"}},[a("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Exploration View")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left","margin-left":"156px","margin-top":"3px"}},[a("i",{staticClass:"fa fa-hand-paper-o icon-flipped",staticStyle:{"font-size":"15px",color:"#f1a340"}}),t._v("Left Hand")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left","margin-left":"25px","margin-top":"3px"}},[a("i",{staticClass:"fa fa-hand-paper-o",staticStyle:{"font-size":"15px",color:"#998ec3"}}),t._v("Right Hand")])}],V=(a("c5f6"),a("7cdf"),a("e2ae")),W=a.n(V),Y=a("bc3a"),X=a.n(Y),U="get",G="post",B=Object({NODE_ENV:"production",BASE_URL:"/"}).DATA_SERVER_URL||"http://127.0.0.1:5014";function j(t,e,a,i){var n;a===U?n=X.a.get:a===G&&(n=X.a.post),n(t,e).then((function(t){200===t.status?i(t):console.error(t)})).catch((function(t){console.error(t)}))}function z(t,e){var a="".concat(B,"/initialization/").concat(t),i={};j(a,i,U,e)}function Z(t,e){var a="".concat(B,"/pose/").concat(t),i={};j(a,i,U,e)}function J(t,e){var a="".concat(B,"/videoInfo/").concat(t),i={};j(a,i,U,e)}function q(t,e){var a="".concat(B,"/vision/").concat(t),i={};j(a,i,U,e)}function K(t,e,a,i){var n="".concat(B,"/audio/").concat(t,"/").concat(e,"/").concat(a),r={};j(n,r,U,i)}function Q(t,e){var a="".concat(B,"/text/").concat(t),i={};j(a,i,U,e)}function tt(t,e,a){var i="".concat(B,"/gesturePhase/").concat(t),n={gesturePhase:e};j(i,n,G,a)}function et(t,e,a){var i="".concat(B,"/phaseLabel/").concat(t),n={phaseLabel:e};j(i,n,G,a)}function at(t,e){var a="".concat(B,"/cluster/").concat(t),i={};j(a,i,U,e)}function it(t,e,a){var i="".concat(B,"/phase/").concat(t),n={phase:e};j(i,n,G,a)}function nt(t,e,a,i){var n="".concat(B,"/data/").concat(t),r={data:a,category:e};j(n,r,G,i)}function rt(t,e,a){var i="".concat(B,"/runcluster/").concat(t,"/").concat(e),n={};j(i,n,U,a)}function st(t,e,a,i){var n="".concat(B,"/runPhraseCluster/").concat(t),r={wordPhraseData:e,clusterNum:a};j(n,r,G,i)}var ot={dataServerUrl:B,initialization:z,videoInfo:J,poseData:Z,visionData:q,audioData:K,textData:Q,saveGesturePhaseData:tt,savePhaseLabelData:et,clusterData:at,savePhaseData:it,saveData:nt,runClusterData:rt,runPhraseClusterData:st},lt=function(t){this.id=t,this.svgWidth=$("#"+t).width(),this.svgHeight=$("#"+t).height(),this.margin={top:10,right:10,bottom:10,left:10},this.width=this.svgWidth-this.margin.left-this.margin.right,this.height=this.svgHeight-this.margin.top-this.margin.bottom,this.showGesture=!0;var e=.2;this.heatmapWidth=e*this.width;var a=F.gestureSpace.extremePeriphery.width/F.gestureSpace.extremePeriphery.height;this.heatmapHeight=this.heatmapWidth/a;var i=this.width-this.heatmapWidth,n=this.height-this.heatmapHeight;this.matrixWidth=d3.min([i,n]),this.matrixHeight=this.matrixWidth;var r=this.margin.left,s=(this.svgHeight-this.heatmapHeight-this.matrixHeight)/2;this.svg=d3.select("#"+t).append("svg").attr("class","matrixSvg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.graphContainer=this.svg.append("g").attr("class","g_main").attr("transform","translate("+r+", "+s+")"),this.heatmapMargin={left:0,top:0},this.heatmapContainer=this.graphContainer.append("g").attr("class","heatmapContainer").attr("transform","translate("+this.heatmapMargin.left+", "+this.heatmapMargin.top+")");var o=this.heatmapContainer.append("g").attr("class","heatmapForeignObject").append("foreignObject").attr("x",0).attr("y",0).attr("width",this.heatmapWidth).attr("height",this.heatmapHeight);o.append("xhtml:div").attr("class","heatmap").style("width",this.heatmapWidth+"px").style("height",this.heatmapHeight+"px"),this.matrixMargin={left:this.heatmapWidth,top:this.heatmapHeight},this.matrixContainer=this.graphContainer.append("g").attr("class","matrixContainer").attr("transform","translate("+this.matrixMargin.left+", "+this.matrixMargin.top+")");var l=this.matrixContainer.append("g").attr("class","matrixForeignObject").append("foreignObject").attr("x",0).attr("y",0).attr("width",this.matrixWidth).attr("height",this.matrixWidth).append("xhtml:div").style("width",this.matrixWidth+"px").style("height",this.matrixWidth+"px"),c=l.append("div").attr("class","tab-header").style("padding-top","10px"),h=l.append("div").attr("class","searchDiv").style("position","absolute").style("z-index",1).style("top","10px").style("left","25px"),d=l.append("div").attr("class","thresholdDiv").style("position","absolute").style("z-index",1).style("top","10px").style("left","170px");h.html('<div style="display: inline-block; margin-right: 5px;"><input type="text" id="matchWordValue" autocomplete="off" name="fname" size=10 style="height:25px;"></div><div style="display: inline-block"><button id="matchWord" style="outline:none;width:20px;height:20px;font-size: 0.9rem;text-align:center;padding: 0;border-radius: 50%; border: 0px;"><i class="fa fa-search"></i></button></div>'),d.html('<div style="display: inline-block; margin-right: 5px;"><i class="fa fa-play icon-rotate" style="transform: rotate(90deg);font-size:12px;color:#75C791"></i> <span style="font-size:12px;"> Change<sub>t</sub>:</span><input type="text" id="changepoint" autocomplete="off" name="fname" size=2 value="0.5" style="height:25px; font-size:12px;"></div><div style="display: inline-block; margin-left: 8px;"><i class="fa fa-minus" style="font-size:12px;color:#fb6a4a"></i> <span style="font-size:12px;"> Variation<sub>t</sub>:</span><input type="text" id="gesturevariation" autocomplete="off" name="fname" size=2 value="0.4" style="height:25px; font-size:12px;"></div>');var p=l.append("div").attr("class","tab-content").style("padding-top","10px");c.html('<ul class="nav nav-tabs small" style="margin-left: 400px"><li class="nav-item ml-auto"><a href="#transcript-content" style="color: black; padding-top:2px; padding-bottom:2px;" class="nav-link active" data-toggle="tab"><i class="fa fa-file"></i></a></li><li class="nav-item"><a href="#transcript-sentence" style="color: black; padding-top:2px; padding-bottom: 2px;" class="nav-link" data-toggle="tab"><i class="fa fa-align-left"></i></a></li></ul>'),p.html('<div class="tab-pane show active" id="transcript-content" style="height: 473.59px; overflow-y: auto;"></div><div class="tab-pane" id="transcript-sentence" style="height: 493.59px;"></div>'),this.textContainer=d3.select("#transcript-sentence").append("div").attr("class","textListContainer").style("width",this.matrixWidth+"px").style("height",this.matrixWidth+"px").style("overflow-y","auto").style("overflow-x","hidden"),this.timelineOneWidth=this.matrixWidth,this.timelineOneHeight=this.heatmapHeight,this.timelineOneMargin={left:this.matrixMargin.left,top:this.heatmapMargin.top},this.timelineOneContainer=this.graphContainer.append("g").attr("class","timelineOneContainer").attr("transform","translate("+this.timelineOneMargin.left+", "+this.timelineOneMargin.top+")"),this.timelineTwoWidth=this.heatmapWidth,this.timelineTwoHeight=this.matrixHeight,this.timelineTwoMargin={left:this.heatmapMargin.left,top:this.matrixMargin.top},this.timelineTwoContainer=this.graphContainer.append("g").attr("class","timelineTwoContainer").attr("transform","translate("+this.timelineTwoMargin.left+", "+this.timelineTwoMargin.top+")")};lt.prototype.layout=function(t){var e=this;this.visionData=t,this.videoInfo=this.visionData["videoInfo"],this.fps=Math.ceil(this.videoInfo["fps"]),this.totalFrameNum=this.videoInfo["totalFrmNum"],this.poseData=this.visionData["poseData"],this.textData=this.visionData["stickmanData"]["textData"],this.sentenceData=this.genSentenceData(this.textData),this.gestureSpaceData=[],this.stdXYJointMax=-1/0,this.stdXYJointMin=1/0,this.changeDistanceMax=-1/0,this.changeDistanceMin=1/0,this.bisect=d3.bisector((function(t){return t})).left,this.sampleInterval=1,this.frameIdxList=d3.range(0,this.videoInfo["totalFrmNum"],this.sampleInterval),this.selectedFrameIdx=0,this.axisTimeRange=.5*parseInt(60/(this.sampleInterval/this.fps));var a=d3.timeFormat("%M:%S");this.formatMinutes=function(t){return a(new Date(2017,0,1,0,0,t))},this.stdXYJointScale=d3.scaleLinear().domain(this.visionData["stickmanData"]["stdXYJointDomain"]).range([0,1]),this.changeDistanceScale=d3.scaleLinear().domain(this.visionData["stickmanData"]["changeDistanceDomain"]).range([0,1]).clamp(!0);var i=this.visionData["movementData"];this.drawSkeleton(),this.drawHeatmap(i),this.drawTimelineOne(i),this.drawTimelineTwo(i),this.drawTranscript(this.textData),o.onUpdateTextList((function(t){e.drawTextList(t)})),o.onSearchSentence((function(t){var e=[t["startFrame"],t["endFrame"]];o.emitUpdateTimeRange(e),o.emitClickFromTextlist(e),o.emitHighlightPoint(e),o.emitFrameBrush(e)})),o.onHighlightText((function(t){if(d3.select("#transcript-content").selectAll(".word").style("border-bottom","1px solid rgba(255, 0, 0, 0)"),0!=t.length)for(var a=t,i=parseFloat((a[0]/e.fps).toFixed(2)),n=parseFloat((a[1]/e.fps).toFixed(2)),r=0;r<e.textData.length;r++)if("pronunciation"==e.textData[r]["type"]){var s=parseFloat(e.textData[r]["start_time"]),o=parseFloat(e.textData[r]["end_time"]),l=o-s;s>=i-l&&o<=n+l&&d3.select("#transcript-content").select(".word-".concat(r)).style("border-bottom","1px solid rgba(255, 0, 0, 1)")}})),o.onSeekFromPhase((function(t){var e=[t["startFrameIdx"],t["endFrameIdx"]];o.emitUpdateTextList([e])})),o.onSelectedPhase((function(t){o.emitUpdateTextList(t)})),o.onMatchWord((function(t){o.emitUpdateTextList(t)})),o.onHighlightWord((function(t){d3.select("#transcript-content").selectAll(".word").style("border-bottom","1px solid rgba(255, 0, 0, 0)");for(var e=0;e<t.length;e++){var a=t[e];d3.select("#transcript-content").select(".word-".concat(a)).style("border-bottom","1px solid rgba(255, 0, 0, 1)")}})),o.onTextShowGesture((function(t){e.showGesture=t,e.showGesture?document.querySelectorAll(".stickman").forEach((function(t){t.style.display="block"})):document.querySelectorAll(".stickman").forEach((function(t){t.style.display="none"}))}))},lt.prototype.drawSkeleton=function(){this.heatmapContainer.select(".skeletonContainer").remove(),this.heatmapContainer.select(".heatmap-canvas").remove();var t=this.heatmapContainer.append("g").attr("class","skeletonContainer"),e=this.heatmapWidth,a=this.heatmapHeight;t.append("clipPath").attr("id","gesture-space-clip-path").append("rect").attr("x",5).attr("y",5).attr("width",e-10).attr("height",a-23);var i=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.left,F.gestureSpace.extremePeriphery.left+F.gestureSpace.extremePeriphery.width]).range([0,e]);this.gestureSpaceXScale=i;var n=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.top,F.gestureSpace.extremePeriphery.top+F.gestureSpace.extremePeriphery.height]).range([0,a]);this.gestureSpaceYScale=n;var r=t.append("g").attr("class","gesture-space"),s=["centerCenter","center","periphery"];r.selectAll("rect").data(s).enter().append("rect").attr("x",(function(t){return i(F.gestureSpace[t].left)})).attr("y",(function(t){return n(F.gestureSpace[t].top)})).attr("width",(function(t){return i(F.gestureSpace[t].left+F.gestureSpace[t].width)-i(F.gestureSpace[t].left)})).attr("height",(function(t){return n(F.gestureSpace[t].top+F.gestureSpace[t].height)-n(F.gestureSpace[t].top)})).style("fill","rgba(0,0,0,0)").style("stroke","#2378ae").style("stroke-dasharray","2,2").style("stroke-linecap","butt").style("stroke-width","1");for(var o=[],l=25,c=0;c<l;c++)o.push([i(F.skeletonInit.points[c.toString()][0]),n(F.skeletonInit.points[c.toString()][1])]);var h=t.append("g").attr("class","skeletonContainer").attr("clip-path","url(#gesture-space-clip-path)"),d=F.BODY25Pairs;h.append("g").attr("class","body-circle-connection").selectAll("line").data(d).enter().append("line").attr("x1",(function(t){return o[t[0]][0]})).attr("y1",(function(t){return o[t[0]][1]})).attr("x2",(function(t){return o[t[1]][0]})).attr("y2",(function(t){return o[t[1]][1]})).style("stroke","#bdbdbd").style("stroke-width",2),h.append("g").attr("class","skeletonCircles").selectAll("cirlce").data(o).enter().append("circle").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",2).style("opacity",.3).style("fill","red")},lt.prototype.drawHeatmap=function(t){var e=this.getHeatMapData(t),a=W.a.create(e.config);a.setData(e.data)},lt.prototype.getHeatMapData=function(t){for(var e=t["selectedPoseDataList"],a={},i=0;i<e.length;i++){var n=e[i];if(n["leftHand"].length>0){var r=Math.round(this.gestureSpaceXScale(n["leftHand"][0]))+"_"+Math.round(this.gestureSpaceYScale(n["leftHand"][1]));a.hasOwnProperty(r)?a[r]+=1:a[r]=1}if(n["rightHand"].length>0){var s=Math.round(this.gestureSpaceXScale(n["rightHand"][0]))+"_"+Math.round(this.gestureSpaceYScale(n["rightHand"][1]));a.hasOwnProperty(s)?a[s]+=1:a[s]=1}}var o=[],l=0;for(var c in a){var h=c.split("_"),d={x:Math.round(parseInt(h[0])),y:parseInt(h[1]),value:a[c]};l=Math.max(l,a[c]),o.push(d)}var p={max:l,data:o},u={container:document.querySelector(".heatmap"),radius:5,maxOpacity:.5,minOpacity:0,blur:1};return{config:u,data:p}},lt.prototype.drawTimelineOne=function(t){var e=this;this.timelineOneContainer.select(".drawTimelineOne").remove();var a=this.timelineOneContainer.append("g").attr("class","drawTimelineOne"),i=this,n=this.timelineOneWidth,r=this.timelineOneHeight,s=20,l=15,c=10,h=d3.scaleLinear().domain([0,this.videoInfo["totalFrmNum"]]).range([0,n]);this.timelineOneXScale=h;var d=this.gestureSpaceYScale,p=F.centerPoint;a.append("g").attr("class","gesture-space-horizontal-line").append("line").attr("x1",0).attr("y1",d(p[1])).attr("x2",n).attr("y2",d(p[1])).style("stroke","black").style("stroke-dasharray","2,2").style("stroke-linecap","butt").style("stroke-width","1");var u=t["selectedPoseDataList"],m=d3.line().x((function(t){return h(t["frameIdx"])})).y((function(t){return d(t["leftHand"][1])})).defined((function(t){return 0!==t["leftHand"].length})).curve(d3.curveMonotoneX),f=d3.line().x((function(t){return h(t["frameIdx"])})).y((function(t){return d(t["rightHand"][1])})).defined((function(t){return 0!==t["rightHand"].length})).curve(d3.curveMonotoneX);a.append("path").attr("class","timelineOne-leftHnad").datum(u).attr("class","line").attr("d",m).style("stroke",F.leftHandColor).style("fill","none"),a.append("path").attr("class","timelineOne-rightHnad").datum(u).attr("class","line").attr("d",f).style("stroke",F.rightHandColor).style("fill","none");var g=d3.axisTop(h).tickFormat((function(t){return 0==t?t:e.formatMinutes(t/e.fps)})).tickValues(d3.range(0,this.totalFrameNum,this.axisTimeRange));a.append("g").attr("transform","translate(0,"+r+")").call(g),a.select(".timelineOne-selected-frame").remove();var v=h(this.selectedFrameIdx);this.frameLineOne=a.append("g").attr("class","selected-frame-one").append("path").attr("class","frame-line-one").attr("d",(function(){var t="M"+v+","+(r-s);return t+=" "+v+","+(l+c),t})).style("stroke","black").style("stroke-width","1px").style("vector-effect","non-scaling-stroke");var y=d3.brushX().extent([[0,l+c],[n,r-s]]).on("end",x);function x(){if(d3.event.sourceEvent){var t=[];if(d3.event.selection){var e=d3.event.selection.map(h.invert);t=[Math.ceil(e[0]),Math.floor(e[1])],o.emitUpdateTextList([t]),o.emitUpdateTimeRange(t),o.emitHighlightText(t),o.emitHighlightPoint(t)}else o.emitUpdateTextList([]),o.emitUpdateTimeRange([0,0]),o.emitHighlightText([]),o.emitHighlightPoint([]);o.emitFrameBrush(t)}}a.append("g").attr("class","brushX").call(y);var S=a.append("g").attr("class","clickArea").attr("transform","translate(0,"+(r-s)+")").append("rect").attr("width",n).attr("height",s).style("opacity",.05).style("fill","D6D6D6");S.on("click",(function(){var t=d3.mouse(this),e=Math.round(h.invert(t[0])),a=i.bisect(i.frameIdxList,e);i.selectedFrameIdx=a,o.emitFrameSelectedFromTimeBar(i.selectedFrameIdx),o.emitUpdateTimeFrame(i.selectedFrameIdx)}));var w=a.append("g").attr("class","markArea").attr("transform","translate(0,0)");w.append("rect").attr("width",n).attr("height",l).style("opacity",.05).style("fill","D6D6D6"),o.onUpdateTimelineMarker((function(t){var a={selectedTimeRanges:t,xScale:h,areaMarkHeight:l};e.drawTimelineOneMarker(w,a)})),o.onFrameSelectedFromVideo((function(t){e.selectedFrameIdx=t;var a=e.timelineOneXScale(e.selectedFrameIdx);e.frameLineOne.transition().duration(200).attr("d",(function(){var t="M"+a+","+(r-s);return t+=" "+a+","+(l+c),t}))})),o.onUpdateTimeFrame((function(t){e.selectedFrameIdx=t;var a=e.timelineOneXScale(e.selectedFrameIdx);e.frameLineOne.transition().duration(200).attr("d",(function(){var t="M"+a+","+(r-s);return t+=" "+a+","+(l+c),t}))})),o.onUpdateTimeRange((function(t){0==t.length?d3.select(".brushX").call(y.move,null):d3.select(".brushX").transition().call(y.move,t.map(e.timelineOneXScale))}))},lt.prototype.drawTimelineOneMarker=function(t,e){var a=e["selectedTimeRanges"],i=e["xScale"],n=e["areaMarkHeight"];t.selectAll("g").remove();var r=t.append("g").attr("class","areaMark"),s=t.append("g").attr("class","clickArea").attr("transform","translate(0,"+(n+6)+")"),l=d3.symbol().size(70).type(d3.symbolTriangle);r.selectAll("rect").data(a).enter().append("rect").attr("class","selectedPhase").attr("x",(function(t){return i(t[0])})).attr("y",0).attr("width",(function(t){var e=t[0],a=t[1];return i(a)-i(e)})).attr("height",n).style("opacity",.4).style("fill","red"),s.selectAll("path").data(a).enter().append("path").attr("transform",(function(t){return"translate("+(i(t[0])+(i(t[1])-i(t[0]))/2)+", 0)"})).attr("d",l()).style("opacity",.4).style("fill","red").on("click",(function(t){o.emitSeekFromPhase({startFrameIdx:t[0],endFrameIdx:t[1]})}))},lt.prototype.drawTimelineTwo=function(t){var e=this;this.timelineTwoContainer.select(".drawTimelineTwo").remove();var a=this.timelineTwoContainer.append("g").attr("class","drawTimelineTwo"),i=this,n=this.timelineTwoWidth,r=this.timelineTwoHeight,s=20,l=15,c=10,h=this.gestureSpaceXScale,d=d3.scaleLinear().domain([0,this.videoInfo["totalFrmNum"]]).range([0,r]);this.timelineTwoYScale=d;var p=F.centerPoint;a.append("g").attr("class","gesture-space-vertical-line").append("line").attr("x1",h(p[0])).attr("y1",0).attr("x2",h(p[0])).attr("y2",r).style("stroke","black").style("stroke-dasharray","2,2").style("stroke-linecap","butt").style("stroke-width","1");var u=t["selectedPoseDataList"],m=d3.line().x((function(t){return h(t["leftHand"][0])})).y((function(t){return d(t["frameIdx"])})).defined((function(t){return 0!==t["leftHand"].length})).curve(d3.curveMonotoneY),f=d3.line().x((function(t){return h(t["rightHand"][0])})).y((function(t){return d(t["frameIdx"])})).defined((function(t){return 0!==t["rightHand"].length})).curve(d3.curveMonotoneY);a.append("path").attr("class","timelineTwo-leftHnad").datum(u).attr("class","line").attr("d",m).style("stroke",F.leftHandColor).style("fill","none"),a.append("path").attr("class","timelineTwo-rightHnad").datum(u).attr("class","line").attr("d",f).style("stroke",F.rightHandColor).style("fill","none");var g=d3.axisLeft(d).tickFormat((function(t){return 0==t?"":e.formatMinutes(t/e.fps)})).tickValues(d3.range(0,this.totalFrameNum,this.axisTimeRange));a.append("g").attr("transform","translate("+n+",0)").call(g),a.select(".timelineTwo-selected-frame").remove();var v=d(this.selectedFrameIdx);this.frameLineTwo=a.append("g").attr("class","timelineTwo-selected-frame").append("path").attr("class","frame-line-two").attr("d",(function(){var t="M"+(n-s)+","+v;return t+=" "+(l+c)+","+v,t})).style("stroke","black").style("stroke-width","1px").style("vector-effect","non-scaling-stroke");var y=d3.brushY().extent([[l+c,0],[n-s,r]]).on("end",x);function x(){if(d3.event.sourceEvent){var t=[];if(d3.event.selection){var e=d3.event.selection.map(d.invert);t=[Math.ceil(e[0]),Math.floor(e[1])],o.emitUpdateTextList([t]),o.emitUpdateTimeRange(t),o.emitHighlightText(t),o.emitHighlightPoint(t)}else o.emitUpdateTextList([]),o.emitUpdateTimeRange([0,0]),o.emitHighlightText([]),o.emitHighlightPoint([]);o.emitFrameBrush(t)}}a.append("g").attr("class","brushY").call(y);var S=a.append("g").attr("class","clickArea").attr("transform","translate("+(n-s)+",0)").append("rect").attr("width",s).attr("height",r).style("opacity",.05).style("fill","D6D6D6");S.on("click",(function(){var t=d3.mouse(this),e=Math.round(d.invert(t[1])),a=i.bisect(i.frameIdxList,e);i.selectedFrameIdx=a,o.emitFrameSelectedFromTimeBar(i.selectedFrameIdx),o.emitUpdateTimeFrame(i.selectedFrameIdx)}));var w=a.append("g").attr("class","markArea").attr("transform","translate(0,0)");w.append("rect").attr("width",l).attr("height",r).style("opacity",.05).style("fill","D6D6D6"),o.onUpdateTimelineMarker((function(t){var a={selectedTimeRanges:t,yScale:d,areaMarkWidth:l};e.drawTimelineTwoMarker(w,a)})),o.onFrameSelectedFromVideo((function(t){e.selectedFrameIdx=t;var a=e.timelineTwoYScale(e.selectedFrameIdx);e.frameLineTwo.transition().duration(200).attr("d",(function(){var t="M"+(n-s)+","+a;return t+=" "+(l+c)+","+a,t}))})),o.onUpdateTimeFrame((function(t){e.selectedFrameIdx=t;var a=e.timelineTwoYScale(e.selectedFrameIdx);e.frameLineTwo.transition().duration(200).attr("d",(function(){var t="M"+(n-s)+","+a;return t+=" "+(l+c)+","+a,t}))})),o.onUpdateTimeRange((function(t){0==t.length?d3.select(".brushY").call(y.move,null):d3.select(".brushY").transition().call(y.move,t.map(e.timelineTwoYScale))}))},lt.prototype.drawTimelineTwoMarker=function(t,e){t.selectAll("g").remove();var a=e["selectedTimeRanges"],i=e["yScale"],n=e["areaMarkWidth"],r=t.append("g").attr("class","areaMark"),s=t.append("g").attr("class","areaClick").attr("transform","translate("+(n+6)+",0)"),l=d3.symbol().size(70).type(d3.symbolTriangle);r.selectAll("rect").data(a).enter().append("rect").attr("class","selectedPhase").attr("x",0).attr("y",(function(t){return i(t[0])})).attr("width",n).attr("height",(function(t){var e=t[0],a=t[1];return i(a)-i(e)})).style("opacity",.4).style("fill","red"),s.selectAll("path").data(a).enter().append("path").attr("transform",(function(t){return"translate(0,"+(i(t[0])+(i(t[1])-i(t[0]))/2)+")rotate(-90)"})).attr("d",l()).style("opacity",.4).style("fill","red").on("click",(function(t){o.emitSeekFromPhase({startFrameIdx:t[0],endFrameIdx:t[1]})}))},lt.prototype.drawTextList=function(t){for(var e=this,a=[],i=0;i<t.length;i++)t[i].push(i),a.push(t[i]),a.push(t[i]);for(var n=[],r=0;r<t.length;r++){for(var s=[],l=t[r],c=parseFloat((l[0]/this.fps).toFixed(2)),h=parseFloat((l[1]/this.fps).toFixed(2)),d=0;d<this.sentenceData.length;d++){var p=parseFloat(this.sentenceData[d][0]["start_time"]),u=parseFloat(this.sentenceData[d][this.sentenceData[d].length-2]["end_time"]);c>u||(h<p||(s=s.concat(this.sentenceData[d])))}n.push(s)}for(var m=[],f=[],g=0;g<n.length;g++){for(var v=[],y={},x=n[g],S=t[g],w=S[0]/this.fps,k=S[1]/this.fps,T=0;T<x.length;T++){var D=x[T],b=parseFloat(D["start_time"]),I=parseFloat(D["end_time"]),P=I-b;D["highlight"]=!1,b>=w-P&&k+P>=I&&(D["highlight"]=!0,v.push(T),y[T]=1)}m.push(v),f.push(y)}var E=this.matrixWidth-20;function M(t,e){var a=["actionArea","textArea"];d3.select(this).selectAll("div").data(a).enter().append("div").attr("class",(function(t){return"".concat(t,"-").concat(e," ").concat(t)})).style("display","inline-block").style("overflow-x",(function(t){return"textArea"==t?"auto":"hidden"})).style("white-space","nowrap").style("width",(function(t){return"textArea"==t?"98%":"2%"})).style("height","100%").style("background-color",(function(t){return"textArea"==t?"#e0e0e0":"#75C791"})),d3.select(this).selectAll("div.actionArea").on("click",C),d3.select(this).selectAll("div.textArea").on("click",A)}function C(){var t=d3.select(this.parentNode).datum()[2],e=document.getElementsByClassName("selected-feature-"+t.toString())[0];e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}function A(){var e=d3.select(this.parentNode).datum()[2],a=t[e];o.emitClickFromTextlist(a)}function H(){var t=d3.select(this.parentNode).datum()[2],a=d3.select(this).selectAll("div").data(n[t]).enter().append("div").style("display","inline-block").style("margin","5px 3px").style("border",(function(e,a){return a in f[t]?"1px solid rgba(255, 0, 0, 1)":"1px solid rgba(255, 0, 0, 0)"}));function i(e,a){d3.select(this).append("div").attr("class",(function(){return"sentence-".concat(t,"-word-").concat(a)})).style("user-select","none").text(e.word).style("color",(function(){return e.polarity>.1?"red":e.polarity<-.1?"blue":void 0}))}a.each(i);var r=40,s=40,l=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.left,F.gestureSpace.extremePeriphery.left+F.gestureSpace.extremePeriphery.width]).range([0,r]),c=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.top,F.gestureSpace.extremePeriphery.top+F.gestureSpace.extremePeriphery.height]).range([0,s]);function h(t,a){if("punctuation"!==t["type"]&&t["jointData"]&&0!=t["jointData"].length){var i=t["jointData"].filter((function(t){return 0!=t.length}));if(0!==i.length){var n=42,h=42,d=40;d3.select(this).selectAll(".listStickman").remove();var p=d3.select(this).insert("div",":first-child").attr("class","stickman-".concat(a," stickman listStickman")).style("width","".concat(n,"px")).style("height","".concat(d,"px")).style("cursor","pointer").style("display",(function(){return e.showGesture?"block":"none"})).on("click",(function(){var a=parseFloat(t["start_time"]),i=parseFloat(t["end_time"]),n=Math.max(0,Math.floor(a*e.fps)),r=Math.min(e.totalFrameNum,Math.ceil(i*e.fps));o.emitSeekFromPhase({startFrameIdx:n,endFrameIdx:r})})),u=p.append("svg").style("width",h).style("height",d),m=(h-r)/2,f=(d-s)/2,g={top:f+10,right:m,bottom:f,left:m},v=u.append("g").attr("class","stickmanGraph").attr("transform","translate("+g.left+", "+g.top+")"),y=v.append("g").attr("class","stickmans");y.selectAll(".oneStickman").data(i).enter().append("g").attr("class","oneStickman").each(x)}}function x(t){d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(F.UPBODYPairs).enter().append("line").attr("x1",(function(e){return l(t[e[0]][0])})).attr("y1",(function(e){return c(t[e[0]][1])})).attr("x2",(function(e){return l(t[e[1]][0])})).attr("y2",(function(e){return c(t[e[1]][1])})).style("stroke","#bdbdbd").style("stroke-width",1.5).style("opacity",.5)}}e.showGesture&&a.each(h),a.each(h)}function R(){var t=d3.select(this.parentNode).datum()[2];if(0!=m[t].length){var e=m[t][0],a=d3.select(".sentence-".concat(t,"-word-").concat(e)).node().offsetLeft;d3.select(".textArea-".concat(t)).node().scrollLeft=a-20}}this.textContainer.selectAll("div").remove(),this.textContainer.selectAll("div").data(a).enter().append("div").attr("class",(function(t,e){return e%2==0?"speech-content selected-content-"+Math.floor(e/2).toString():"speech-feature selected-feature-"+Math.floor(e/2).toString()+" collapse"})).style("width",E+"px").style("height",(function(t,e){return e%2==0?"80px":"100px"})).style("background-color",(function(t,e){return e%2==0?"#e0e0e0":"#bababa"})).style("margin","10px 20px 10px 10px"),d3.selectAll(".speech-content").each(M),d3.selectAll(".listStickman").remove(),d3.selectAll(".speech-content").selectAll(".textArea").each(H),d3.selectAll(".speech-content").selectAll(".textArea").each(R)},lt.prototype.genSentenceData=function(t){for(var e=t,a=[],i=[],n=0;n<e.length;n++){var r=e[n];r["sentenceIdx"]=a.length,i.push(r),"punctuation"===r["type"]&&(a.push(i),i=[]),n===e.length-1&&0!==i.length&&a.push(i)}return a},lt.prototype.drawTranscript=function(t){(function(){d3.custom={};var t=null,a=!1,i=null,n=null;function r(r,s){a&&(d3.select("#transcript-content").selectAll(".word").style("border-bottom","1px solid rgba(255, 0, 0, 0)"),a=!1,e.wordStartIdx=i,e.wordEndIdx=n,e.sentenceSelected=a),t=s.target;var o=d3.select(t).attr("class");i=parseInt(o.split(" ")[0].split("-")[1])}function s(r,s){if(t&&!a){var o=s.target,l=d3.select(o).attr("class");n=parseInt(l.split(" ")[0].split("-")[1]);var c=[];if(Number.isInteger(i)&&Number.isInteger(n)){d3.select("#transcript-content").selectAll(".word").style("border-bottom","1px solid rgba(255, 0, 0, 0)");for(var h=i;h<=n;h++)d3.select("#transcript-content").select(".word-".concat(h)).style("border-bottom","1px solid rgba(255, 0, 0, 1)"),c.push(e.textData[h].word)}a=!0,e.wordStartIdx=i,e.wordEndIdx=n,e.sentenceSelected=a,p()}t=null,i=null,n=null}d3.custom.brush=function(t){t.on("mousedown",(function(){r(this,event)})).on("mouseup",(function(){s(this,event)})),d3.select(document).on("mouseup",(function(){s(this,event)})),document.oncontextmenu=function(){return!1},document.onselectstart=function(){return!1}}})();var e=this;d3.select("#transcript-content").selectAll("*").remove();var a=d3.select("#transcript-content").selectAll("div").data(t).enter().append("div").style("display","inline-block");function i(t,e){d3.select(this).append("div").attr("class","word-".concat(e," word")).attr("selected",!1).style("user-select","none").style("padding","0px 3px 1px 3px").style("cursor","crosshair").style("border-bottom","1px solid rgba(255, 0, 0, 0)").call(d3.custom.brush).text(t.word)}a.each(i);var n=40,r=40,s=.4,l=.5,c=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.left,F.gestureSpace.extremePeriphery.left+F.gestureSpace.extremePeriphery.width]).range([0,n]),h=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.top,F.gestureSpace.extremePeriphery.top+F.gestureSpace.extremePeriphery.height]).range([0,r]);function d(a,i){if("punctuation"!==a["type"]){if(a["jointData"]&&0!=a["jointData"].length){var d=a["jointData"].filter((function(t){return 0!=t.length}));if(0!==d.length){var p=a["stdXYJoint"],u=$(".word-".concat(i)).outerWidth(),m=u,f=40,g=d3.select(this).insert("div",":first-child").attr("class","stickman-".concat(i," stickman")).style("width","".concat(u,"px")).style("height","".concat(f,"px")).style("cursor","pointer").style("display",(function(){return e.showGesture?"block":"none"})).on("click",(function(){var t=parseFloat(a["start_time"]),i=parseFloat(a["end_time"]),n=Math.max(0,Math.floor(t*e.fps)),r=Math.min(e.totalFrameNum,Math.ceil(i*e.fps));o.emitSeekFromPhase({startFrameIdx:n,endFrameIdx:r})})),v=g.append("svg").style("width",m).style("height",f),y=(m-n)/2,x=(f-r)/2,S={top:x+10,right:y,bottom:x,left:y},w=v.append("g").attr("class","stickmanGraph").attr("transform","translate("+S.left+", "+S.top+")"),k=v.append("g").attr("class","changePoint"),T=t[i]["changeDistance"];if(i>1&&"punctuation"!=t[i-1]["type"]&&e.changeDistanceScale(T)>s){var D="".concat(0,",3,",5,",3,",0,",13");k.append("polyline").attr("class","leftPoints").style("fill","#75C791").attr("points",D)}if(i<t.length-1&&"punctuation"!==t[i+1]["type"]){var b=t[i+1]["changeDistance"];if(e.changeDistanceScale(b)>s){var I="".concat(m,",3,").concat(m-5,",3,").concat(m,",13");k.append("polyline").attr("class","rightPoints").style("fill","#75C791").attr("points",I)}}var P=w.append("g").attr("class","stickmans");P.selectAll(".oneStickman").data(d).enter().append("g").attr("class","oneStickman").each(N);var E=a["averageJoint"];P.append("g").attr("class","averageStickman").selectAll("line").data(F.UPBODYPairs).enter().append("line").attr("x1",(function(t){return c(E[t[0]][0])})).attr("y1",(function(t){return h(E[t[0]][1])})).attr("x2",(function(t){return c(E[t[1]][0])})).attr("y2",(function(t){return h(E[t[1]][1])})).style("stroke",(function(){return e.stdXYJointScale(p)>l?"#fb6a4a":"black"})).style("stroke-width",.5).style("opacity",(function(){return e.stdXYJointScale(p)>l?1:e.stdXYJointScale(p)}))}}}else if(i<t.length-2&&e.changeDistanceScale(t[i+1]["changeDistance"])>s){var M=$(".word-".concat(i)).outerWidth(),C=M,A=40,H=d3.select(this).insert("div",":first-child").attr("class","stickman-".concat(i," stickman")).style("width","".concat(M,"px")).style("height","".concat(A,"px")).style("display",(function(){return e.showGesture?"block":"none"})),R=H.append("svg").style("width",C).style("height",A),L=R.append("g").attr("class","changePoint").attr("transform","translate("+C/2+", 0)"),_="".concat(0,",3,",-5,",3,",0,",13");L.append("polyline").attr("class","leftPoints").style("fill","#75C791").attr("points",_);var O="".concat(0,",3,",5,",3,",0,",13");L.append("polyline").attr("class","rightPoints").style("fill","#75C791").attr("points",O)}function N(t){d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(F.UPBODYPairs).enter().append("line").attr("x1",(function(e){return c(t[e[0]][0])})).attr("y1",(function(e){return h(t[e[0]][1])})).attr("x2",(function(e){return c(t[e[1]][0])})).attr("y2",(function(e){return h(t[e[1]][1])})).style("stroke","#bdbdbd").style("stroke-width",1.5).style("opacity",e.stdXYJointScale(p))}}function p(){if(e.sentenceSelected&&Number.isInteger(e.wordStartIdx)&&Number.isInteger(e.wordEndIdx)){var t=-1,a=-1;t="pronunciation"==e.textData[e.wordStartIdx]["type"]?parseFloat(e.textData[e.wordStartIdx]["start_time"]):parseFloat(e.textData[e.wordStartIdx+1]["start_time"]),a="pronunciation"==e.textData[e.wordEndIdx]["type"]?parseFloat(e.textData[e.wordEndIdx]["end_time"]):parseFloat(e.textData[e.wordEndIdx-1]["end_time"]);var i={wordStartIdx:e.wordStartIdx,wordEndIdx:e.wordEndIdx,startTime:t,endTime:a,startFrame:Math.max(0,Math.ceil(t*e.fps)),endFrame:Math.min(e.totalFrameNum,Math.floor(a*e.fps))};o.emitSearchSentence(i)}}a.each(d);var u=document.getElementById("matchWord");function m(){var t=document.getElementById("matchWordValue").value.toLowerCase();if(0===t.length)return o.emitHighlightWord([]),void console.log("need to input a word");for(var a=[],i=[],n=0;n<e.textData.length;n++){var r=e.textData[n]["word"].toLowerCase();t==r&&(a.push(e.textData[n]),i.push(n))}for(var s=[],l=0;l<a.length;l++){var c=a[l],h=parseFloat(c["start_time"]),d=parseFloat(c["end_time"]),p=Math.max(0,Math.ceil(h*e.fps)),u=Math.min(e.totalFrameNum,Math.floor(d*e.fps));s.push([p,u])}o.emitHighlightWord(i),o.emitMatchWord(s)}u.addEventListener("click",m)},lt.prototype.genStickmanData=function(){for(var t=d3.scaleLinear().range([0,Math.abs(F.skeletonInit.points["1"][1]-F.skeletonInit.points["8"][1])]),e=0;e<Object.keys(this.poseData).length;e++)if(1===this.poseData[e.toString()]["people"].length){var a=this.poseData[e.toString()]["people"][0]["pose_keypoints_2d"];if(0!==a[2]&&0!==a[5]&&0!==a[8]&&0!==a[11]&&0!==a[14]&&0!==a[17]&&0!==a[20]&&0!==a[23]&&0!==a[26]){t.domain([0,Math.abs(a[4]-a[25])]);for(var i=[],n=0;n<8;n++){var r=[F.skeletonInit.points["2"][0]+t(a[3*n+0]-a[6]),F.skeletonInit.points["2"][1]+t(a[3*n+1]-a[7])];i.push(r)}this.gestureSpaceData.push(i)}else this.gestureSpaceData.push([])}else this.gestureSpaceData.push([]);for(var s=0;s<this.textData.length;s++){var o=this.textData[s];if("punctuation"!==o.type){var l=parseFloat(o["start_time"]),c=parseFloat(o["end_time"]),h=Math.max(0,Math.floor(l*this.fps)),d=Math.min(this.totalFrameNum,Math.ceil(c*this.fps));o["jointData"]=this.gestureSpaceData.slice(h,d);var p=o["jointData"].filter((function(t){return 0!=t.length}));if(0===p.length)o["averageJoint"]=[];else{for(var u=[],m=0,f=0;f<8;f++){for(var g=0,v=0,y=0;y<p.length;y++){var x=p[y];g+=x[f][0],v+=x[f][1]}var S=g/p.length,w=v/p.length;u.push([S,w]);for(var k=0,T=0;T<p.length;T++){var D=p[T];k+=Math.pow(D[f][0]-S,2),k+=Math.pow(D[f][1]-w,2)}var b=Math.sqrt(k);m+=b}if(o["averageJoint"]=u,o["stdXYJoint"]=m/8,this.stdXYJointMax<o["stdXYJoint"]&&(this.stdXYJointMax=o["stdXYJoint"]),this.stdXYJointMin>o["stdXYJoint"]&&(this.stdXYJointMin=o["stdXYJoint"]),0==s)o["changeDistance"]=-1;else{var I=[],P=[],E=0;if("punctuation"===this.textData[s]["type"])continue;P=this.textData[s],I="punctuation"===this.textData[s-1]["type"]?this.textData[s-2]:this.textData[s-1],0==I["averageJoint"].length?E=-2:0==P["averageJoint"].length?E=-3:(E=M(I["averageJoint"],P["averageJoint"]),this.changeDistanceMax<E&&(this.changeDistanceMax=E),this.changeDistanceMin>E&&(this.changeDistanceMin=E)),o["changeDistance"]=E}}}}function M(t,e){for(var a=0,i=0;i<t.length;i++)a+=Math.sqrt(Math.pow(t[i][0]-e[i][0],2)+Math.pow(t[i][1]-e[i][1],2));return a}this.stdXYJointScale=d3.scaleLinear().domain([this.stdXYJointMin,this.stdXYJointMax]).range([0,1]),this.changeDistanceScale=d3.scaleLinear().domain([this.changeDistanceMin,this.changeDistanceMax]).range([0,1]).clamp(!0);var C={textData:this.textData,stdXYJointDomain:[this.stdXYJointMin,this.stdXYJointMax],changeDistanceDomain:[this.changeDistanceMin,this.changeDistanceMax]};ot.saveData(this.videoInfo["videoId"],"stickmanData",C,(function(t){console.log("stickmanData feedback: ",t)}))};var ct=lt,ht={name:"MatrixView",components:{},props:{videoId:String,videoData:Object},data:function(){return{containerId:"matrixContainer",gestureToggled:!0}},watch:{videoData:function(t){this.drawMatrix.layout(t)},gestureToggled:function(t){this.gestureToggled=t,o.emitTextShowGesture(this.gestureToggled)}},mounted:function(){this.drawMatrix=new ct(this.containerId)}},dt=ht,pt=(a("312f"),Object(R["a"])(dt,O,N,!1,null,"c4132750",null)),ut=pt.exports,mt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},ft=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"dynamicview"}},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-header",staticStyle:{padding:"6px 12px"}},[a("div",{staticStyle:{float:"left","margin-left":"20px"}},[a("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Dynamic View")])])]),a("div",{staticClass:"card-block",attrs:{id:"dynamicContainer"}})])])}],gt=function(t){this.id=t,this.svgWidth=$("#"+t).width(),this.svgHeight=$("#"+t).height(),this.margin={top:0,right:0,bottom:0,left:0},this.sliderHeight=30,this.width=this.svgWidth-this.margin.left-this.margin.right,this.height=this.svgHeight-this.margin.top-this.margin.bottom-this.sliderHeight,this.svg=d3.select("#"+t).append("svg").attr("class","dynamicSvg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.sliderContainer=this.svg.append("g").attr("class","sliderContainer").attr("transform","translate("+(this.margin.left+15)+", "+(this.margin.top+15)+")"),this.graphContainer=this.svg.append("g").attr("class","g_main").attr("transform","translate("+this.margin.left+", "+(this.margin.top+this.sliderHeight)+")"),this.gestureSpaceContainer=this.graphContainer.append("g").attr("class","gestureSpaceContainer")};gt.prototype.layout=function(t){var e=this;this.visionData=t,this.videoInfo=this.visionData["videoInfo"],this.poseData=this.visionData["poseData"],this.bisect=d3.bisector((function(t){return t})).left;var a=1;this.frameIdxList=d3.range(0,this.videoInfo["totalFrmNum"],a),this.selectedFrameIdx=0,this.sampleRatio=1/3,this.fps=Math.ceil(this.videoInfo["fps"]);var i=d3.timeFormat("%M:%S");this.formatMinutes=function(t){return i(new Date(2017,0,1,0,0,t))},this.timer=null,this.frameSelection=[],this.drawGestureSpace(),this.drawSkeleton(0),o.onAnimationFrameFromVideo((function(t){0!=e.frameSelection.length&&e.frameSelection[0]<=t&&t<=e.frameSelection[1]&&(e.handle.attr("cx",e.sliderXScale(t)),e.label.attr("x",e.sliderXScale(t)).text(e.formatMinutes(t/e.fps)),e.drawSkeleton(t),e.highlightMovement(t))})),this.drawMovementAnimation([0,0]),o.onFrameBrush((function(t){e.frameSelection=t,e.drawMovement(t),e.drawMovementAnimation(t)}))},gt.prototype.drawGestureSpace=function(){this.gestureSpaceContainer.selectAll("*").remove();var t=this.width,e=this.height,a=t/e,i=F.gestureSpace.extremePeriphery.width,n=F.gestureSpace.extremePeriphery.height,r=i/n;r>a?e=t/r:t=e*r;var s=(this.width-t)/2,o=(this.height-e)/2,l={top:o,right:s,bottom:o,left:s},c=25,h=this.gestureSpaceContainer.append("g").attr("class","spaceContainer").attr("transform","translate("+l.left+", "+(l.top+c)+")");this.skeletonContainer=this.gestureSpaceContainer.append("g").attr("class","skeletonContainer").attr("transform","translate("+l.left+", "+(l.top+c)+")"),this.movementContainer=this.gestureSpaceContainer.append("g").attr("class","movementContainer").attr("transform","translate("+l.left+", "+(l.top+c)+")");var d=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.left,F.gestureSpace.extremePeriphery.left+F.gestureSpace.extremePeriphery.width]).range([0,t]);this.gestureSpaceXScale=d;var p=d3.scaleLinear().domain([F.gestureSpace.extremePeriphery.top,F.gestureSpace.extremePeriphery.top+F.gestureSpace.extremePeriphery.height]).range([0,e]);this.gestureSpaceYScale=p;var u=["centerCenter","center","periphery"];h.selectAll("rect").data(u).enter().append("rect").attr("x",(function(t){return d(F.gestureSpace[t].left)})).attr("y",(function(t){return p(F.gestureSpace[t].top)})).attr("width",(function(t){return d(F.gestureSpace[t].left+F.gestureSpace[t].width)-d(F.gestureSpace[t].left)})).attr("height",(function(t){return p(F.gestureSpace[t].top+F.gestureSpace[t].height)-p(F.gestureSpace[t].top)})).style("fill","rgba(0,0,0,0)").style("stroke","#2378ae").style("stroke-dasharray","2,2").style("stroke-linecap","butt").style("stroke-width","1").style("opacity",.3)},gt.prototype.drawMovement=function(t){this.movementContainer.selectAll("*").remove();for(var e=this.gestureSpaceXScale,a=this.gestureSpaceYScale,i=this.getMovementData(t),n=i["selectedPoseDataList"],r=this.movementContainer,s=[],o=[],l=0;l<n.length;l++)n[l]["leftHand"].length>0&&s.push(n[l]["leftHand"]),n[l]["rightHand"].length>0&&o.push(n[l]["rightHand"]);this.leftHandPoints=s,this.rightHandPoints=o;var c=d3.line().x((function(t){return e(t[0])})).y((function(t){return a(t[1])})).curve(d3.curveMonotoneX);r.append("g").attr("class","leftHandLine").append("path").datum(s).attr("class","handLine").attr("d",c),r.append("g").attr("class","rightHandLine").append("path").datum(o).attr("class","handLine").attr("d",c),r.append("g").attr("class","leftHandCircle").selectAll("cirlce").data(s).enter().append("circle").attr("class","leftCircle").attr("cx",(function(t){return e(t[0])})).attr("cy",(function(t){return a(t[1])})).attr("r",(function(t,e){return 0==e||e==s.length-1?5:1})).style("fill",(function(){return F.leftHandColor})).style("position","relative").style("z-index",(function(t,e){return 0==e||e==s.length-1?100:0})).style("opacity",.1),r.append("g").attr("class","rightHandCircle").selectAll("cirlce").data(o).enter().append("circle").attr("class","rightHand").attr("cx",(function(t){return e(t[0])})).attr("cy",(function(t){return a(t[1])})).attr("r",(function(t,e){return 0==e||e==o.length-1?5:1})).style("fill",(function(){return F.rightHandColor})).style("position","relative").style("z-index",(function(t,e){return 0==e||e==o.length-1?100:0})).style("opacity",.1)},gt.prototype.highlightMovement=function(t){var e=this;this.movementContainer.select("g.highlightHands").remove();var a=this.movementContainer.append("g").attr("class","highlightHands"),i=t-this.frameSelection[0],n=this.leftHandPoints.slice(0,i+1),r=this.rightHandPoints.slice(0,i+1);a.append("g").attr("class","leftHandCircle").selectAll("cirlce").data(n).enter().append("circle").attr("class","leftCircle").attr("cx",(function(t){return e.gestureSpaceXScale(t[0])})).attr("cy",(function(t){return e.gestureSpaceYScale(t[1])})).attr("r",(function(t,a){return 0==a||a==e.leftHandPoints.length-1||a==i?5:1})).style("fill",(function(){return F.leftHandColor})).style("position","relative").style("z-index",(function(t,a){return 0==a||a==e.leftHandPoints.length-1?100:0})).style("opacity",(function(t,e){return i-e<10?1:0})),a.append("g").attr("class","rightHandCircle").selectAll("cirlce").data(r).enter().append("circle").attr("class","rightHand").attr("cx",(function(t){return e.gestureSpaceXScale(t[0])})).attr("cy",(function(t){return e.gestureSpaceYScale(t[1])})).attr("r",(function(t,a){return 0==a||a==e.rightHandPoints.length-1||a===i?5:1})).style("fill",(function(){return F.rightHandColor})).style("position","relative").style("z-index",(function(t,a){return 0==a||a==e.rightHandPoints.length-1?100:0})).style("opacity",(function(t,e){return i-e<100?1:0}))},gt.prototype.drawMovementAnimation=function(t){this.sliderContainer.selectAll("*").remove(),this.skeletonContainer.selectAll("*").remove();var e=this,a=40,i=20,n=this.sliderContainer.append("g").attr("transform","translate(0, "+(this.sliderHeight/2-i/2)+")").append("rect").attr("class","play-button").attr("rx",5).attr("ry",5).attr("width",a).attr("height",i),r=this.sliderContainer.append("g").attr("transform","translate("+a/2+","+(this.sliderHeight/2+5)+")").append("text").attr("class","rectLabel").attr("text-anchor","middle");r.text("Play"),n.on("click",(function(){"Pause"==r.text()?(s=!1,r.text("Play"),o.emitPlayVideoFromSlider({status:"pause",frameSelection:t})):(s=!0,r.text("Pause"),o.emitPlayVideoFromSlider({status:"play",frameSelection:t})),console.log("Slider moving: "+s)}));var s=!1,l=20,c=this.width-a-l-50,h=d3.scaleLinear().domain([t[0],t[1]]).range([0,c]).clamp(!0);this.sliderXScale=h;var d=this.sliderContainer.append("g").attr("class","slider").attr("transform","translate("+(a+l)+","+this.sliderHeight/2+")");function p(t){e.handle.attr("cx",h(t)),e.label.attr("x",h(t)).text(e.formatMinutes(t/e.fps));var a=Math.round(t);e.drawSkeleton(a),o.emitVideoFrameFromSlider(a)}d.append("line").attr("class","track").attr("x1",0).attr("x2",c).select((function(){return this.parentNode.appendChild(this.cloneNode(!0))})).attr("class","track-inset").select((function(){return this.parentNode.appendChild(this.cloneNode(!0))})).attr("class","track-overlay").call(d3.drag().on("start.interrupt",(function(){d.interrupt()})).on("start drag",(function(){var t=d3.event.x;p(h.invert(t))}))),d.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,18)").selectAll("text").data(h.domain()).enter().append("text").attr("x",h).attr("y",10).attr("text-anchor","middle").text((function(t){return e.formatMinutes(t/e.fps)})).style("font-size","12px"),this.handle=d.insert("circle",".track-overlay").attr("class","sliderHandle").attr("r",5),this.label=d.append("text").attr("class","label").attr("text-anchor","middle").text(e.formatMinutes(t[0]/e.fps)).style("font-size","12px").attr("transform","translate(0,-10)")},gt.prototype.drawSkeleton=function(t){if(1===this.poseData[t.toString()]["people"].length){var e=this.poseData[t.toString()]["people"][0]["pose_keypoints_2d"];if(0!==e[2]&&0!==e[5]&&0!==e[8]&&0!==e[17]&&0!==e[26]){var a=d3.scaleLinear().domain([0,Math.abs(e[4]-e[25])]).range([0,Math.abs(F.skeletonInit.points["1"][1]-F.skeletonInit.points["8"][1])]);this.skeletonContainer.selectAll("*").remove();for(var i=[],n=25,r=0;r<n;r++)if(0===e[3*r+2])i.push([]);else{var s=[F.skeletonInit.points["1"][0]+a(e[3*r+0]-e[3]),F.skeletonInit.points["1"][1]+a(e[3*r+1]-e[4])];i.push([this.gestureSpaceXScale(s[0]),this.gestureSpaceYScale(s[1])])}var o=F.BODY25Pairs;this.skeletonContainer.append("g").attr("class","body-circle-connection").selectAll("line").data(o.filter((function(t){return 0!=i[t[0]].length&&0!=i[t[1]].length}))).enter().append("line").attr("x1",(function(t){return i[t[0]][0]})).attr("y1",(function(t){return i[t[0]][1]})).attr("x2",(function(t){return i[t[1]][0]})).attr("y2",(function(t){return i[t[1]][1]})).style("stroke","#bdbdbd").style("stroke-width",2).style("opacity",.3),this.skeletonContainer.append("g").attr("class","skeletonCircles").selectAll("cirlce").data(i.filter((function(t){return 0!=t.length}))).enter().append("circle").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",2).style("fill","red").style("opacity",.3)}}},gt.prototype.getMovementData=function(t){for(var e=d3.scaleLinear().range([0,Math.abs(F.skeletonInit.points["1"][1]-F.skeletonInit.points["8"][1])]),a=d3.scaleLinear().range([0,Math.abs(F.skeletonInit.points["1"][1]-F.skeletonInit.points["8"][1])]),i=[],n=[],r=t[0];r<t[1];r++)if(1===this.poseData[r.toString()]["people"].length){var s=this.poseData[r.toString()]["people"][0]["pose_keypoints_2d"];if(0!==s[2]&&0!==s[5]&&0!==s[8]&&0!==s[17]&&0!==s[26]&&(0!==s[14]||0!==s[23])){e.domain([0,Math.abs(s[4]-s[25])]),a.domain([0,Math.abs(s[4]-s[25])]);var o=[],l=[];0!=s[14]&&(o=[F.skeletonInit.points["1"][0]+e(s[12]-s[3]),F.skeletonInit.points["1"][1]+a(s[13]-s[4])]),0!=s[23]&&(l=[F.skeletonInit.points["1"][0]+e(s[21]-s[3]),F.skeletonInit.points["1"][1]+a(s[22]-s[4])]),i.push({leftHand:l,rightHand:o}),n.push(r)}}return{selectedPoseDataList:i,selectedFrameIdxList:n}};var vt=gt,yt={name:"DynamicView",components:{},props:{videoId:String,videoData:Object},data:function(){return{containerId:"dynamicContainer",audioData:{},interval:5,sliding:1,dynamicType:"animation"}},watch:{videoData:function(t){this.drawDynamic.layout(t)}},mounted:function(){this.drawDynamic=new vt(this.containerId)}},xt=yt,St=(a("aacf"),Object(R["a"])(xt,mt,ft,!1,null,null,null)),wt=St.exports,kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"relationview"}},[a("div",{staticClass:"card"},[t._m(0),a("div",{staticClass:"card-block"},[a("div",{staticStyle:{margin:"0 20px 0px 20px"},attrs:{id:"configuration"}},[a("div",{staticStyle:{width:"100%",height:"25px"}},[t._m(1),a("div",{staticStyle:{width:"75%",float:"left","margin-left":"10px","margin-top":"5px"}},[a("vue-slider",{ref:"timeSlider",attrs:{data:t.timeData,max:t.timeMax,marks:!0,"hide-label":!0,adsorb:!0,lazy:!0},model:{value:t.timeFilter,callback:function(e){t.timeFilter=e},expression:"timeFilter"}})],1)]),a("div",{staticStyle:{width:"100%",height:"25px"}},[t._m(2),a("div",{staticStyle:{width:"75%",float:"left","margin-left":"10px","margin-top":"5px"}},[a("vue-slider",{ref:"numSlider",attrs:{min:1,max:t.numMax,marks:!0,"hide-label":!0,adsorb:!0,lazy:!0},model:{value:t.numFilter,callback:function(e){t.numFilter=e},expression:"numFilter"}})],1)])]),a("div",{staticStyle:{width:"100%",height:"50px","border-bottom":"dashed 1px"},attrs:{id:"relationColorLegend"}}),t._m(3),t._m(4)])])])},Tt=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-header"},[a("div",{staticStyle:{float:"left","margin-left":"10px","margin-top":"-3px"}},[a("h6",{staticStyle:{display:"inline","user-select":"none"}},[t._v("Relation View")])]),a("div",{staticStyle:{float:"right","margin-right":"10px","margin-top":"-5px"}},[a("button",{attrs:{id:"refreshButton"}},[a("span",{staticClass:"fa fa-refresh"})])]),a("div",{staticStyle:{float:"right","margin-right":"10px","margin-top":"-5px"}},[a("button",{attrs:{id:"bookmarkButton"}},[a("span",{staticClass:"fa fa-bookmark"})])]),a("div",{staticStyle:{float:"right","margin-right":"10px","margin-top":"-5px"}},[a("button",{attrs:{id:"lassoButton"}},[a("span",{staticClass:"fa fa-crosshairs"})])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left"}},[a("span",{staticStyle:{"font-size":"12px","user-select":"none"}},[t._v("timeFilter:")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{float:"left"}},[a("span",{staticStyle:{"font-size":"12px","user-select":"none"}},[t._v("numFilter: ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"relationContainer"}},[a("div",{staticStyle:{position:"absolute","font-size":"10px",display:"none"},attrs:{id:"my_custom_menu"}},[a("div",{staticClass:"annotation",staticStyle:{cursor:"pointer",width:"40px",background:"rgb(244,244,244)",stroke:"white","stroke-width":"1px","margin-bottom":"1px"},attrs:{id:"gestureMark"}},[t._v("Mark")]),a("div",{staticClass:"annotation",staticStyle:{cursor:"pointer",width:"40px",background:"rgb(244,244,244)",stroke:"white","stroke-width":"1px"},attrs:{id:"gestureRemove"}},[t._v("Remove")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"absolute",left:"1px",top:"2px",display:"none",width:"333px",background:"rgb(244,244,244)","z-index":"1000"},attrs:{id:"bookmarkContainer"}},[a("div",{staticStyle:{width:"333px",height:"40px","font-size":"12px","border-bottom":"dashed","border-width":"1px"},attrs:{id:"bookmarkHeader"}},[a("div",{staticStyle:{display:"inline-block","margin-top":"10px","border-right":"solid","border-width":"1px",width:"40%"}},[t._v("Gesture")]),a("div",{staticStyle:{display:"inline-block","margin-top":"10px","border-right":"solid","border-width":"1px",width:"40%"}},[t._v("Annotation")]),a("div",{staticStyle:{display:"inline-block","margin-top":"10px",width:"20%"}},[t._v("Delete")])]),a("div",{staticStyle:{height:"340px","overflow-y":"auto"},attrs:{id:"bookmarkBody"}})])}],Dt=(a("c7c6"),a("4dda"),Dt||{REVISION:"ALPHA"});(function(t){var e=function(t,e){if(!t)throw e||"Assertion failed"},a=function(t,e,a){return t.hasOwnProperty(e)?t[e]:a},i=!1,n=0,r=function t(){if(i)return i=!1,n;var e=2*Math.random()-1,a=2*Math.random()-1,r=e*e+a*a;if(0==r||r>1)return t();var s=Math.sqrt(-2*Math.log(r)/r);return n=a*s,i=!0,e*s},s=function(t,e){return t+r()*e},o=function(t){if("undefined"===typeof t||isNaN(t))return[];if("undefined"===typeof ArrayBuffer){for(var e=new Array(t),a=0;a<t;a++)e[a]=0;return e}return new Float64Array(t)},l=function(t,e,a){for(var i="undefined"!==typeof a,n=[],r=0;r<t;r++){for(var o=[],l=0;l<e;l++)i?o.push(a):o.push(s(0,1e-4));n.push(o)}return n},c=function(t,e){for(var a=t.length,i=0,n=0;n<a;n++){var r=t[n],s=e[n];i+=(r-s)*(r-s)}return i},h=function(t){for(var e=t.length,a=o(e*e),i=0;i<e;i++)for(var n=i+1;n<e;n++){var r=c(t[i],t[n]);a[i*e+n]=r,a[n*e+i]=r}return a},d=function(t,a,i){var n=Math.sqrt(t.length),r=Math.floor(n);e(r===n,"D should have square number of elements.");for(var s=Math.log(a),l=o(r*r),c=o(r),h=0;h<r;h++){var d=-1/0,p=1/0,u=1,m=!1,f=50,g=0;while(!m){for(var v=0,y=0;y<r;y++){var x=Math.exp(-t[h*r+y]*u);h===y&&(x=0),c[y]=x,v+=x}var S=0;for(y=0;y<r;y++){if(0==v)x=0;else x=c[y]/v;c[y]=x,x>1e-7&&(S-=x*Math.log(x))}S>s?(d=u,p===1/0?u*=2:u=(u+p)/2):(p=u,d===-1/0?u/=2:u=(u+d)/2),g++,Math.abs(S-s)<i&&(m=!0),g>=f&&(m=!0)}for(y=0;y<r;y++)l[h*r+y]=c[y]}var w=o(r*r),k=2*r;for(h=0;h<r;h++)for(y=0;y<r;y++)w[h*r+y]=Math.max((l[h*r+y]+l[y*r+h])/k,1e-100);return w};function p(t){return t>0?1:t<0?-1:0}var u=function(t){t=t||{};this.perplexity=a(t,"perplexity",30),this.dim=a(t,"dim",2),this.epsilon=a(t,"epsilon",10),this.iter=0};u.prototype={initDataRaw:function(t){var a=t.length,i=t[0].length;e(a>0," X is empty? You must have some data!"),e(i>0," X[0] is empty? Where is the data?");var n=h(t);this.P=d(n,this.perplexity,1e-4),this.N=a,this.initSolution()},initDataDist:function(t){var a=t.length;e(a>0," X is empty? You must have some data!");for(var i=o(a*a),n=0;n<a;n++)for(var r=n+1;r<a;r++){var s=t[n][r];i[n*a+r]=s,i[r*a+n]=s}this.P=d(i,this.perplexity,1e-4),this.N=a,this.initSolution()},initSolution:function(){this.Y=l(this.N,this.dim),this.gains=l(this.N,this.dim,1),this.ystep=l(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var t=this.N,e=this.costGrad(this.Y),a=e.cost,i=e.grad,n=o(this.dim),r=0;r<t;r++)for(var s=0;s<this.dim;s++){var l=i[r][s],c=this.ystep[r][s],h=this.gains[r][s],d=p(l)===p(c)?.8*h:h+.2;d<.01&&(d=.01),this.gains[r][s]=d;var u=this.iter<250?.5:.8,m=u*c-this.epsilon*d*i[r][s];this.ystep[r][s]=m,this.Y[r][s]+=m,n[s]+=this.Y[r][s]}for(r=0;r<t;r++)for(s=0;s<this.dim;s++)this.Y[r][s]-=n[s]/t;return a},debugGrad:function(){for(var t=this.N,e=this.costGrad(this.Y),a=(e.cost,e.grad),i=1e-5,n=0;n<t;n++)for(var r=0;r<this.dim;r++){var s=this.Y[n][r];this.Y[n][r]=s+i;var o=this.costGrad(this.Y);this.Y[n][r]=s-i;var l=this.costGrad(this.Y),c=a[n][r],h=(o.cost-l.cost)/(2*i);console.log(n+","+r+": gradcheck analytic: "+c+" vs. numerical: "+h),this.Y[n][r]=s}},costGrad:function(t){for(var e=this.N,a=this.dim,i=this.P,n=this.iter<100?4:1,r=o(e*e),s=0,l=0;l<e;l++)for(var c=l+1;c<e;c++){for(var h=0,d=0;d<a;d++){var p=t[l][d]-t[c][d];h+=p*p}var u=1/(1+h);r[l*e+c]=u,r[c*e+l]=u,s+=2*u}for(var m=e*e,f=o(m),g=0;g<m;g++)f[g]=Math.max(r[g]/s,1e-100);var v=0,y=[];for(l=0;l<e;l++){var x=new Array(a);for(d=0;d<a;d++)x[d]=0;for(c=0;c<e;c++){v+=-i[l*e+c]*Math.log(f[l*e+c]);var S=4*(n*i[l*e+c]-f[l*e+c])*r[l*e+c];for(d=0;d<a;d++)x[d]+=S*(t[l][d]-t[c][d])}y.push(x)}return{cost:v,grad:y}}},t.tSNE=u})(Dt);var bt=Dt,It=a("910e"),Pt=function(t){var e=this;this.id=t,this.svgWidth=$("#"+t).width(),this.svgHeight=$("#"+t).height(),this.margin={top:10,right:10,bottom:10,left:10},this.width=this.svgWidth-this.margin.left-this.margin.right,this.height=this.svgHeight-this.margin.top-this.margin.bottom,this.svg=d3.select("#"+t).append("svg").attr("class","relationSvg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.upperWidth=this.width,this.upperHeight=.47*this.height,this.upperZoomedTransform={},this.betweenHeight=.06*this.height,this.lowerWidth=this.width,this.lowerHeight=.47*this.height,this.svg.append("g").attr("class","zoomClip").attr("transform","translate("+this.margin.left+", "+this.margin.top+")").append("defs").append("clipPath").attr("id","upperClip").append("rect").attr("x",0).attr("y",0).attr("width",this.upperWidth).attr("height",this.upperHeight).style("fill","black").style("opacity",.05),this.upperContainer=this.svg.append("svg").attr("class","upperContainer").attr("x",this.margin.left).attr("y",this.margin.top).attr("width",this.upperWidth).attr("height",this.upperHeight).attr("clip-path","url(#upperClip)").style("pointer-events","all"),this.upperContainer.append("rect").attr("class","zoomArea").attr("x",0).attr("y",0).attr("width",this.upperWidth).attr("height",this.upperHeight).style("fill-opacity",0).style("stroke","#bdbdbd").style("stroke-width","1px").style("stroke-opacity",.4),this.svg.append("g").attr("class","zoomClip").attr("transform","translate("+this.margin.left+", "+(this.margin.top+this.upperHeight+this.betweenHeight)+")").append("defs").append("clipPath").attr("id","lowerClip").append("rect").attr("x",0).attr("y",0).attr("width",this.lowerWidth).attr("height",this.lowerHeight).style("fill","black").style("opacity",0),this.lowerContainer=this.svg.append("svg").attr("class","lowerContainer").attr("x",this.margin.left).attr("y",this.margin.top+this.upperHeight+this.betweenHeight).attr("width",this.lowerWidth).attr("height",this.lowerHeight).attr("clip-path","url(#lowerClip)").style("pointer-events","all"),this.lowerContainer.append("rect").attr("class","zoomArea").attr("x",0).attr("y",0).attr("width",this.lowerWidth).attr("height",this.lowerHeight).style("fill-opacity",0).style("stroke","#bdbdbd").style("stroke-width","1px").style("stroke-opacity",.4),this.linksContainer=this.svg.append("g").attr("class","linksContainer").attr("transform","translate("+this.margin.left+", "+this.margin.top+")"),this.linkPointData=[],this.drawPhraseLegend(),this.linkVertical=d3.linkVertical().x((function(t){return t.x})).y((function(t){return t.y})),this.timeFilter=[0,1],this.numMax=0,this.numFilter=[1,13],this.legendFilter={noun_phrases:"NP",prepositional_phrases:"PP",subject_verb_object:"SVO",verb_phrases:"VP",open:1,closed:1,others:1},this.lassoFlag=!1,this.textRefreshFlag=!1,this.gestureRefreshFlag=!1,this.upperZoom="",this.lowerZoom="",this.bookmarkContainer=d3.select("#bookmarkBody"),this.bookmarkData=[],this.curGestureClusterData={},this.updateBookmark(),d3.select("#bookmarkButton").on("click",(function(){var t=d3.select("#bookmarkContainer").style("display");"block"==t?d3.select("#bookmarkContainer").style("display","none"):d3.select("#bookmarkContainer").style("display","block")})),d3.select("#gestureMark").on("mouseover",(function(){d3.select(this).style("background-color","rgb(200,200,200)")})).on("mouseout",(function(){d3.select(this).style("background-color","rgb(244,244,244)")})),d3.select("#gestureRemove").on("mouseover",(function(){d3.select(this).style("background-color","rgb(200,200,200)")})).on("mouseout",(function(){d3.select(this).style("background-color","rgb(244,244,244)")})),$("#gestureMark").on("click",(function(){console.log("gestureMark"),e.bookmarkData.push(e.curGestureClusterData),e.updateBookmark()})),$("#gestureRemove").on("click",(function(){console.log("gestureRemove");for(var t=0;t<e.bookmarkData.length;t++)e.bookmarkData[t]["gestureIdx"]==e.curGestureClusterData["gestureIdx"]&&e.bookmarkData.splice(t,1);e.updateBookmark()}))};Pt.prototype.layout=function(t){var e=this;this.visionData=t,this.videoInfo=this.visionData["videoInfo"],this.fps=Math.ceil(this.videoInfo["fps"]),this.totalFrameNum=this.videoInfo["totalFrmNum"],this.poseData=this.visionData["poseData"],this.gestureSpaceData=this.visionData["gestureSpaceData"];var a=this.visionData["wordPhrase"],i=this.visionData["wordPhraseDataResult"],n={},r={};0===Object.keys(i).length?(i=this.getWordPhraseData(a),this.numMax=i["numMax"],r=i["wordPhraseData"],n=this.calculatePosition(r),i["positionInfo"]=n,ot.saveData(this.videoInfo["videoId"],"wordPhraseDataResult",i,(function(t){console.log("saveWordPhraseDataResult, feedback: ",t)}))):(r=i["wordPhraseData"],n=i["positionInfo"],this.numMax=i["numMax"]),this.textXScale=d3.scaleLinear().domain(n["textPositionInfo"]["xDomain"]).range([0,this.upperWidth]),this.textYScale=d3.scaleLinear().domain(n["textPositionInfo"]["yDomain"]).range([this.upperHeight,0]),this.textRScale=d3.scaleLinear().domain(n["textPositionInfo"]["rDomain"]).range([4,15]),this.textXScaleZoom=this.textXScale,this.textYScaleZoom=this.textYScale,this.textNewZoomXScale=this.textXScale,this.textNewZoomYScale=this.textYScale,this.gestureXScale=d3.scaleLinear().domain(n["gesturePositionInfo"]["xDomain"]).range([0,this.lowerWidth]),this.gestureYScale=d3.scaleLinear().domain(n["gesturePositionInfo"]["yDomain"]).range([this.lowerHeight,0]),this.gestureSpaceScale=d3.scaleLinear().domain([0,1]).range([0,32]),this.gestureXScaleZoom=this.gestureXScale,this.gestureYScaleZoom=this.gestureYScale,this.gestureNewZoomXScale=this.gestureXScale,this.gestureNewZoomYScale=this.gestureYScale,this.distanceChangeScale=d3.scaleLinear().domain(n["distanceChangeInfo"]["distanceChangeDomain"]).range([0,8]),this.drawCluster(r),o.onTimeFilter((function(t){e.timeFilter=t,e.drawCluster(r)})),o.onNumFilter((function(t){e.numFilter=t,e.drawCluster(r)})),o.onLegendFilter((function(){e.drawCluster(r)})),o.onHighlightPoint((function(t){if(0==t.length)d3.selectAll(".text-circles").style("stroke-width","0px"),d3.selectAll(".gesture-circles").style("stroke-opacity",.1).style("stroke","black"),d3.selectAll(".circle-texts").style("fill","black").style("font-weight",300);else{d3.selectAll(".text-circles").style("stroke-width","0px"),d3.selectAll(".gesture-circles").style("stroke-opacity",.1).style("stroke","black");var e=t[0]/s.fps,a=t[1]/s.fps;d3.selectAll(".text-circles").filter((function(t){for(var i=t["timeRange"],n=0;n<i.length;n++)if(i[n][0]>=e&&i[n][1]<=a)return!0;return!1})).style("stroke","red").style("stroke-opacity",1).style("stroke-width","1px"),d3.selectAll(".circle-texts").filter((function(t){for(var i=t["timeRange"],n=0;n<i.length;n++)if(i[n][0]>=e&&i[n][1]<=a)return!0;return!1})).style("fill","black").style("font-weight",350),d3.selectAll(".gesture-circles").filter((function(t){var i=t["timeRange"];return i[0]>=e&&i[1]<=a})).style("stroke","red").style("stroke-opacity",1).style("stroke-width","1px")}}));var s=this;$("#lassoButton").on("click",(function(){s.lassoFlag?(d3.select(this).style("color","black"),s.upperContainer.style("pointer-events","auto"),s.upperContainer.select(".zoomArea").style("pointer-events","auto"),s.lowerContainer.style("pointer-events","auto"),s.lowerContainer.select(".zoomArea").style("pointer-events","auto")):(d3.select(this).style("color","red"),s.upperContainer.style("pointer-events","none"),s.upperContainer.select(".zoomArea").style("pointer-events","none"),s.lowerContainer.style("pointer-events","none"),s.lowerContainer.select(".zoomArea").style("pointer-events","none")),s.lassoFlag=!s.lassoFlag})),$("#refreshButton").on("click",(function(){s.upperZoomedTransform={},s.linkPointData=[],s.textRefreshFlag=!0,s.gestureRefreshFlag=!0,s.textXScaleZoom=s.textXScale,s.textYScaleZoom=s.textYScale,s.textNewZoomXScale=this.textXScale,s.textNewZoomYScale=this.textYScale,s.gestureXScaleZoom=s.gestureXScale,s.gestureYScaleZoom=s.gestureYScale,this.gestureNewZoomXScale=this.gestureXScale,this.gestureNewZoomYScale=this.gestureYScale,s.textRefreshFlag&&(s.textRefreshFlag=!1,s.upperContainer.call(s.upperZoom.transform,d3.zoomIdentity)),s.gestureRefreshFlag&&(s.gestureRefreshFlag=!1,s.lowerContainer.call(s.lowerZoom.transform,d3.zoomIdentity)),s.drawCluster(r),d3.selectAll(".linkPaths").remove()}))},Pt.prototype.drawPhraseLegend=function(){var t=this;this.legendWidth=$("#relationColorLegend").width(),this.legendHeight=$("#relationColorLegend").height();var e=d3.select("#relationColorLegend").append("svg").attr("width",this.legendWidth).attr("height",this.legendHeight).append("g").attr("transform","translate(5, 0)"),a=["NP","PP","VP","SVO"],i=["open","closed","others"];e.append("g").attr("class","textLegend").append("text").attr("class","legendText user-select").attr("x",16).attr("y",16).text("textType: ").style("font-size","12px").style("font-family","'Avenir', Helvetica, Arial, sans-serif").style("text-anchor","left").style("user-select","none"),e.append("g").attr("class","textLegend").selectAll("circle").data(a).enter().append("circle").attr("cx",(function(t,e){return 50*e+80})).attr("cy",13).attr("r",6).style("fill",(function(t){return F.PhraseColor[t]})).style("stroke-width","0px").on("click",(function(e){t.legendFilter.hasOwnProperty(F.PhraseMappingReverse[e])?(delete t.legendFilter[F.PhraseMappingReverse[e]],d3.select(this).style("fill","white").style("stroke","black").style("stroke-width","1px")):(t.legendFilter[F.PhraseMappingReverse[e]]=e,d3.select(this).style("fill",(function(t){return F.PhraseColor[t]})).style("stroke-width","0px")),o.emitLegendFilter()})),e.append("g").attr("class","textLegend").selectAll("text").data(a).enter().append("text").attr("class","legendText user-select").attr("x",(function(t,e){return 50*e+100})).attr("y",17).text((function(t){return t})).style("font-size","12px").style("text-anchor","middle").style("user-select","none"),e.append("g").attr("class","gestureLegend").append("text").attr("class","legendText user-select").attr("x",16).attr("y",37).text("gestureType: ").style("font-size","12px").style("font-family","'Avenir', Helvetica, Arial, sans-serif").style("text-anchor","left").style("user-select","none"),e.append("g").attr("class","gestureLegend").selectAll("circle").data(i).enter().append("circle").attr("cx",(function(t,e){return 65*e+110})).attr("cy",33).attr("r",6).style("fill",(function(t){return F.gestureTypeColor[t]})).style("stroke-width","0px").on("click",(function(e){t.legendFilter.hasOwnProperty(e)?(delete t.legendFilter[e],d3.select(this).style("fill","white").style("stroke","black").style("stroke-width","1px")):(t.legendFilter[e]=1,d3.select(this).style("fill",(function(t){return F.gestureTypeColor[t]})).style("stroke-width","0px")),o.emitLegendFilter()})),e.append("g").attr("class","textLegend").selectAll("text").data(i).enter().append("text").attr("class","legendText user-select").attr("x",(function(t,e){return 65*e+135})).attr("y",37).text((function(t){return t})).style("font-size","12px").style("text-anchor","middle").style("user-select","none")},Pt.prototype.getWordPhraseData=function(t){var e=[],a=0,i=0;for(var n in t){var r=t[n],s={};if("entities"!=n){if("subject_verb_object"!=n)for(var o=0;o<r.length;o++){var l=r[o]["text"].toLowerCase();l in s?s[l]["timeRange"].push([parseFloat(r[o]["start_time"]),parseFloat(r[o]["end_time"])]):s[l]={timeRange:[[parseFloat(r[o]["start_time"]),parseFloat(r[o]["end_time"])]],vector:r[o]["vector"]}}else for(var c=0;c<r.length;c++){for(var h="".concat(r[c][0]["text"]," ").concat(r[c][1]["text"]," ").concat(r[c][2]["text"]).toLowerCase(),d=[parseFloat(r[c][0]["start_time"]),parseFloat(r[c][0]["end_time"])],p=[],u=0;u<r[c][0]["vector"].length;u++)p.push((r[c][0]["vector"][u]+r[c][1]["vector"][u]+r[c][2]["vector"][u])/3);h in s?s[h]["timeRange"].push(d):s[h]={timeRange:[d],vector:p}}for(var m in s){for(var f=s[m],g=[],v=0;v<f["timeRange"].length;v++)void 0==f["timeRange"][v][0]||void 0==f["timeRange"][v][1]||isNaN(f["timeRange"][v][0])||isNaN(f["timeRange"][v][1])||g.push(f["timeRange"][v]);0!=g.length&&(e.push({phraseIdx:i,vector:f["vector"],timeRange:g,type:n,text:m}),i+=1,g.length>a&&(a=g.length))}}}return{wordPhraseData:e,numMax:a}},Pt.prototype.calculatePosition=function(t){var e=this.calculateTextPosition(t),a=this.calculateAverageJoint(t),i=this.calculateGesturePosition(t),n={textPositionInfo:e,gesturePositionInfo:i,distanceChangeInfo:a};return n},Pt.prototype.calculateTextPosition=function(t){for(var e={epsilon:10,perplexity:30,dim:2},a=new bt.tSNE(e),i=[],n=0;n<t.length;n++)i.push(t[n]["vector"]);a.initDataRaw(i);for(var r=0;r<500;r++)a.step();for(var s=a.getSolution(),o=0;o<t.length;o++)t[o]["textPosition"]=s[o];for(var l=-1/0,c=1/0,h=-1/0,d=1/0,p=-1/0,u=1/0,m=0;m<t.length;m++){var f=t[m]["textPosition"];f[0]>l&&(l=f[0]),f[0]<c&&(c=f[0]),f[1]>h&&(h=f[1]),f[1]<d&&(d=f[1]);var g=t[m]["timeRange"].length;g>p&&(p=g),g<u&&(u=g)}var v={xDomain:[c,l],yDomain:[d,h],rDomain:[u,p]};return v},Pt.prototype.calculateAverageJoint=function(t){for(var e=-1/0,a=1/0,i=0;i<t.length;i++){for(var n=t[i],r=n["timeRange"],s=[],o=[],l=[],c=0;c<r.length;c++){var h=r[c][0],d=r[c][1],p=Math.max(0,Math.floor(h*this.fps)),u=Math.min(this.totalFrameNum,Math.ceil(d*this.fps)),m=this.gestureSpaceData.slice(p,u);s=s.concat(m);var f=m.filter((function(t){return 0!=t.length}));0!=f.length&&(l.push([h,d]),o.push(f))}n["timeRange"]=l;var g=s.filter((function(t){return 0!=t.length}));if(n["jointData"]=g,n["timeRangeJointData"]=o,0===g.length)n["averageJoint"]=[];else{for(var v=[],y=0;y<8;y++){for(var x=0,S=0,w=0;w<g.length;w++){var k=g[w];x+=k[3*y+0],S+=k[3*y+1]}var T=x/g.length,D=S/g.length;v.push([T,D])}n["averageJoint"]=v}n["timeRangeAverageJoint"]=[],n["timeRangeGestureType"]=[];for(var b=0;b<o.length;b++){for(var I=o[b],P=[],E=0;E<8;E++){for(var F=0,M=0,C=0;C<I.length;C++){var A=I[C];F+=A[3*E+0],M+=A[3*E+1]}var H=F/I.length,R=M/I.length;P.push([H,R])}n["timeRangeAverageJoint"].push(P),n["timeRangeGestureType"].push(this.gestureType(P))}n["gestureDistanceChange"]=[];for(var L=0;L<o.length;L++){for(var _=o[L],O=n["timeRangeAverageJoint"][L],N=[],V=0;V<O.length;V++)N=N.concat([O[V][0],O[V][1],1]);for(var W=[],$=0;$<_.length;$++){var Y=this.gestureDistance(N,_[$]);W.push(Y),Y>e&&(e=Y),Y<a&&(a=Y)}n["gestureDistanceChange"].push(W)}}return{distanceChangeDomain:[a,e]}},Pt.prototype.calculateGesturePosition=function(t){for(var e={epsilon:10,perplexity:30,dim:2},a=new bt.tSNE(e),i={},n=0,r=[],s=0;s<t.length;s++){t[s]["gesturePositionList"]=[];for(var o=t[s]["timeRangeAverageJoint"],l=0;l<o.length;l++){for(var c=[],h=o[l],d=0;d<h.length;d++)c=c.concat(h[d]);r.push(c),i[n]=s,n+=1}}a.initDataRaw(r);for(var p=0;p<500;p++)a.step();for(var u=a.getSolution(),m=0;m<r.length;m++){var f=i[m];t[f]["gesturePositionList"].push(u[m])}for(var g=-1/0,v=1/0,y=-1/0,x=1/0,S=-1/0,w=1/0,k=0;k<u.length;k++){var T=u[k];T[0]>g&&(g=T[0]),T[0]<v&&(v=T[0]),T[1]>y&&(y=T[1]),T[1]<x&&(x=T[1]);var D=t[i[k]]["timeRange"].length;D>S&&(S=D),D<w&&(w=D)}var b={xDomain:[v,g],yDomain:[x,y],rDomain:[w,S]};return b},Pt.prototype.drawCluster=function(t){for(var e=[],a=this.totalFrameNum/this.fps,i=a*this.timeFilter[0],n=a*this.timeFilter[1],r=this.numFilter[0],s=this.numFilter[1],o=0;o<t.length;o++)if(0!=t[o]["timeRange"].length){var l=t[o]["timeRange"][0][0],c=t[o]["timeRange"][0][1],h=t[o]["timeRange"].length,d=t[o]["type"];i<=l&&c<=n&&r<=h&&h<=s&&this.legendFilter.hasOwnProperty(d)&&e.push(t[o])}this.drawTextCluster(e),this.drawGestureCluster(e);var p={circles:this.svg.selectAll(".lasso-circles")};d3.selectAll("g.lasso").remove(),this.drawLasso(p)},Pt.prototype.drawTextCluster=function(t){var e=this;e.upperContainer.selectAll("g").remove();var a=e.upperContainer.append("g"),i=t.map((function(t){return[e.textXScaleZoom(t["textPosition"][0]),e.textYScaleZoom(t["textPosition"][1])]})),n=2e3,r=d3.voronoi().extent([[0,0],[e.upperWidth,e.upperHeight]]),s=r.polygons(i),l=a.selectAll("g").data(t).enter().append("g").attr("transform",(function(t){return"translate("+e.textXScaleZoom(t["textPosition"][0])+", "+e.textYScaleZoom(t["textPosition"][1])+")"}));function c(){e.textNewZoomXScale=d3.event.transform.rescaleX(e.textXScale),e.textNewZoomYScale=d3.event.transform.rescaleY(e.textYScale);var t=d3.event.transform;e.upperZoomedTransform=t,a.attr("transform","translate("+t.x+","+t.y+")scale("+t.k+")"),a.selectAll("circle").attr("transform","scale("+1/t.k+")"),a.selectAll("text").attr("transform","scale("+1/t.k+")").attr("opacity",(function(e){return t.k>e.scaleThreshold?e.opacityScale(t.k):0})),e.drawLinks(e.linkPointData)}l.append("circle").attr("class",(function(t){return"lasso-circles text-circles text-circle-"+t["phraseIdx"].toString()})).attr("r",(function(t){return e.textRScale(t["timeRange"].length)})).style("fill",(function(t){return F.PhraseColor[F.PhraseMapping[t["type"]]]})).on("click",(function(t){var a=t["timeRange"][0],i=a[0]*e.fps,n=a[1]*e.fps,r=[i,n];o.emitUpdateTimeRange(r),o.emitHighlightText(r)})),l.append("text").attr("class",(function(t){return"circle-texts circle-text-"+t["phraseIdx"].toString()})).each((function(t,e){void 0!=s[e]&&(t.scaleThreshold=Math.sqrt(n/d3.polygonArea(s[e])),t.opacityScale=d3.scaleLinear().domain([t.scaleThreshold,1.3*t.scaleThreshold]).range([0,1]))})).attr("opacity",(function(t){return t.scaleThreshold<1?1:0})).attr("x",(function(t){return e.textRScale(t["timeRange"].length)})).text((function(t){return t["text"]})).style("font-size","13px").style("pointer-events","none"),$.isEmptyObject(e.upperZoomedTransform)||(a.attr("transform","translate("+e.upperZoomedTransform.x+","+e.upperZoomedTransform.y+")scale("+e.upperZoomedTransform.k+")"),a.selectAll("circle").attr("transform","scale("+1/e.upperZoomedTransform.k+")"),a.selectAll("text").attr("transform","scale("+1/e.upperZoomedTransform.k+")").attr("opacity",(function(t){return e.upperZoomedTransform.k>t.scaleThreshold?t.opacityScale(e.upperZoomedTransform.k):0}))),e.upperZoom=d3.zoom().scaleExtent([.5,40]).extent([[0,0],[this.upperWidth,this.upperHeight]]).on("zoom",c),this.upperContainer.call(e.upperZoom)},Pt.prototype.drawGestureCluster=function(t){var e=this;e.lowerContainer.selectAll("g").remove();var a=e.lowerContainer.selectAll("g");e.lowerContainer.on("click",(function(){d3.select("#my_custom_menu").style("display","none")}));for(var i=[],n=0;n<t.length;n++)for(var r=0;r<t[n]["gesturePositionList"].length;r++)e.legendFilter.hasOwnProperty(t[n]["timeRangeGestureType"][r])&&i.push({gesturePosition:t[n]["gesturePositionList"][r],phraseIdx:t[n]["phraseIdx"],gestureIdx:r,jointData:t[n]["timeRangeJointData"][r],textPosition:t[n]["textPosition"],gestureType:t[n]["timeRangeGestureType"][r],gestureChange:t[n]["gestureDistanceChange"][r],timeRange:t[n]["timeRange"][r]});var s=a.data(i).enter().append("g").attr("class","gestureGlyph").attr("transform",(function(t){return"translate("+e.gestureXScaleZoom(t["gesturePosition"][0])+", "+e.gestureYScaleZoom(t["gesturePosition"][1])+")"}));function l(){e.gestureNewZoomXScale=d3.event.transform.rescaleX(e.gestureXScale),e.gestureNewZoomYScale=d3.event.transform.rescaleY(e.gestureYScale),s.data(i).attr("transform",(function(t){return"translate("+e.gestureNewZoomXScale(t["gesturePosition"][0])+", "+e.gestureNewZoomYScale(t["gesturePosition"][1])+")"})),e.drawLinks(e.linkPointData)}function c(t){var a=d3.select(this),i=t["jointData"],n=16;if(0!=i.length){a.append("circle").attr("class","lasso-circles gesture-circles gesture-circle-".concat(t["phraseIdx"]," gesture-circle-").concat(t["phraseIdx"],"-").concat(t["gestureIdx"])).attr("cx",0).attr("cy",0).attr("r",n).style("fill",F.gestureTypeColor[t["gestureType"]]).style("fill-opacity",.2).style("stroke","black").style("stroke-opacity",.1).on("click",(function(t){var a=t["timeRange"],i=a[0]*e.fps,n=a[1]*e.fps,r=[i,n];o.emitUpdateTimeRange(r),o.emitHighlightText(r)})).on("contextmenu",(function(t){d3.select("#my_custom_menu").style("position","absolute").style("left",d3.event.pageX-10+"px").style("top",d3.event.pageY-95+"px").style("display","block"),e.curGestureClusterData=t,d3.event.preventDefault()}));for(var r=t["gestureChange"],s=[],l=0;l<r.length-1;l++)for(var c=d3.interpolateNumber(r[l],r[l+1]),h=0;h<1;h+=.05)s.push(c(h));var d=d3.scaleLinear().domain([0,s.length-1]).range([0,2*Math.PI]),p=d3.areaRadial().angle((function(t,e){return d(e)})).innerRadius((function(t){return n-.5-e.distanceChangeScale(t)})).outerRadius(n-.5);a.append("path").attr("class","gestureChange").data([s]).attr("class","area").attr("d",p).style("fill","green").style("opacity",.8);var u=a.append("g").attr("class","stickman-glyph").attr("transform","translate("+-n+", "+-n+")");u.selectAll(".oneStickman").data(i).enter().append("g").attr("class","oneStickman").each(m)}function m(t){d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(F.UPBODYPairs).enter().append("line").attr("x1",(function(a){return e.gestureSpaceScale(t[3*a[0]+0])})).attr("y1",(function(a){return e.gestureSpaceScale(t[3*a[0]+1])})).attr("x2",(function(a){return e.gestureSpaceScale(t[3*a[1]+0])})).attr("y2",(function(a){return e.gestureSpaceScale(t[3*a[1]+1])})).style("stroke","#bdbdbd").style("stroke-width",1.5).style("pointer-events","none")}}s.each(c),e.lowerZoom=d3.zoom().scaleExtent([.5,40]).extent([[0,0],[this.lowerWidth,this.lowerHeight]]).on("zoom",l),this.lowerContainer.call(e.lowerZoom)},Pt.prototype.filterClusterWordIdxList=function(t,e,a,i){for(var n=[],r=this.totalFrameNum/this.fps,s=r*e[0],o=r*e[1],l=a[0],c=a[1],h=0;h<t.length;h++){var d=t[h]["timeRange"][0][0],p=t[h]["timeRange"][0][1],u=t[h]["timeRange"].length,m=t[h]["type"];s<=d&&p<=o&&l<=u&&u<=c&&i.hasOwnProperty(m)&&n.push(t[h]["phraseIdx"])}return n},Pt.prototype.drawLasso=function(t){var e=this,a=t["circles"],i=function(){s.items().classed("not_possible",!0).classed("selected",!1),e.linksContainer.selectAll("path").remove()},n=function(){s.possibleItems().classed("not_possible",!1).classed("possible",!0),s.notPossibleItems().classed("not_possible",!0).classed("possible",!1)},r=function(){s.items().classed("not_possible",!1).classed("possible",!1),s.selectedItems().classed("selected",!0).style("stroke","red").style("stroke-opacity",1).style("stroke-width","1px"),s.notSelectedItems().filter(".text-circles").style("stroke-width","0px"),s.notSelectedItems().filter(".gesture-circles").style("stroke-opacity",.1).style("stroke","black"),d3.selectAll(".circle-texts").style("fill","black").style("font-weight",300);for(var t={},a=[],i=s.selectedItems().data(),n=0;n<i.length;n++){var r=i[n]["phraseIdx"];t.hasOwnProperty(r)?t[r]+=1:(t[r]=1,a.push(i[n])),d3.select(".text-circle-".concat(r)).style("stroke","red").style("stroke-width","1px"),d3.select(".circle-text-".concat(r)).style("font-weight","350"),i[n].hasOwnProperty("gestureIdx")?d3.select(".gesture-circle-".concat(r,"-").concat(i[n]["gestureIdx"])).style("stroke","red").style("stroke-width","1px").style("stroke-opacity",1):d3.select(".gesture-circle-".concat(r)).style("stroke","red").style("stroke-width","1px").style("stroke-opacity",1)}e.linkPointData=a,e.drawLinks(a)},s=It["lasso"]().closePathSelect(!0).closePathDistance(100).items(a).targetArea(this.svg).on("start",i).on("draw",n).on("end",r);this.svg.call(s)},Pt.prototype.drawLinks=function(t){var e=this;e.linksContainer.selectAll("*").remove();for(var a=[],i=0;i<t.length;i++){var n=[],r=[];t[i].hasOwnProperty("gesturePositionList")?(n=t[i]["gesturePositionList"],r=t[i]["timeRangeGestureType"]):(n=[t[i]["gesturePosition"]],r=[t[i]["gestureType"]]);for(var s=0;s<n.length;s++)if(e.legendFilter.hasOwnProperty(r[s])){var o={x:e.textNewZoomXScale(t[i]["textPosition"][0]),y:e.textNewZoomYScale(t[i]["textPosition"][1])},l={x:e.gestureNewZoomXScale(n[s][0]),y:e.gestureNewZoomYScale(n[s][1])+e.upperHeight+e.betweenHeight};a.push({source:o,target:l})}}e.linksContainer.selectAll("path").data(a).enter().append("path").attr("class","linkPaths").attr("fill","none").attr("stroke","#6baed6").attr("stroke-width","0.5px").attr("d",e.linkVertical)},Pt.prototype.gestureType=function(t){var e="",a=t[5],i=t[2],n=t[7],r=t[4],s=Math.hypot(n[0]-r[0],n[1]-r[1]),o=Math.hypot(a[0]-i[0],a[1]-i[1]);return e=s>1.3*o?"open":s<.7*o?"closed":"others",e},Pt.prototype.gestureDistance=function(t,e){for(var a=0,i=0;i<8;i++)a+=Math.pow(t[3*i+0]-e[3*i+0],2)+Math.pow(t[3*i+1]-e[3*i+1],2);return a},Pt.prototype.updateBookmark=function(){this.bookmarkContainer.selectAll("*").remove();var t=this,e=this.bookmarkContainer.selectAll("div").data(this.bookmarkData).enter().append("div").attr("class",(function(t,e){return"bookmark-row-"+e})).style("width","330px").style("height","80px").style("margin","2px").style("border-bottom","dashed").style("border-width","1px"),a=["gesture","annotation","action"],i={gesture:Math.round(132),annotation:Math.round(132),action:Math.round(66)};e.selectAll("div").data(a).enter().append("div").attr("class",(function(t){return t})).style("width",(function(t){return i[t]+"px"})).style("height","80px").style("display","inline-block").style("position","relative").style("left","0px").style("top",(function(t){return"gesture"==t?"-6px":"annotation"==t?"-0px":"-30px"}));var n=80,r=i["gesture"],s=60,l=60,c={top:(n-l)/2,right:(r-s)/2,bottom:(n-l)/2,left:(r-s)/2},h=d3.scaleLinear().domain([0,1]).range([0,s]);function d(e){var a=d3.select(this).select(".gestureSvg").append("g").attr("transform","translate("+(c.left+s/2)+", "+(c.top+l/2)+")"),i=e["jointData"],n=s/2;if(0!=i.length){a.append("circle").attr("class","lasso-circles gesture-circles gesture-circle-".concat(e["phraseIdx"]," gesture-circle-").concat(e["phraseIdx"],"-").concat(e["gestureIdx"])).attr("cx",0).attr("cy",0).attr("r",n).style("fill",F.gestureTypeColor[e["gestureType"]]).style("fill-opacity",.1).style("stroke","black").style("stroke-opacity",.1).on("click",(function(){var a=e["timeRange"],i=a[0]*t.fps,n=a[1]*t.fps,r=[i,n];o.emitUpdateTimeRange(r),o.emitHighlightText(r)}));for(var r=e["gestureChange"],d=[],p=0;p<r.length-1;p++)for(var u=d3.interpolateNumber(r[p],r[p+1]),m=0;m<1;m+=.05)d.push(u(m));var f=d3.scaleLinear().domain([0,d.length-1]).range([0,2*Math.PI]),g=d3.areaRadial().angle((function(t,e){return f(e)})).innerRadius((function(e){return n-.5-t.distanceChangeScale(e)})).outerRadius(n-.5);a.append("path").attr("class","gestureChange").data([d]).attr("class","area").attr("d",g).style("fill","green");var v=a.append("g").attr("class","stickman-glyph").attr("transform","translate("+-n+", "+-n+")");v.selectAll(".oneStickman").data(i).enter().append("g").attr("class","oneStickman").each(y)}function y(t){d3.select(this).append("g").attr("class","body-point-connection").selectAll("line").data(F.UPBODYPairs).enter().append("line").attr("x1",(function(e){return h(t[3*e[0]+0])})).attr("y1",(function(e){return h(t[3*e[0]+1])})).attr("x2",(function(e){return h(t[3*e[1]+0])})).attr("y2",(function(e){return h(t[3*e[1]+1])})).style("stroke","#bdbdbd").style("stroke-width",1.5).style("pointer-events","none")}}e.selectAll("div.gesture").append("svg").attr("class","gestureSvg").attr("width",r).attr("height",n),e.each(d),e.selectAll("div.annotation").append("div").style("position","relative").style("top","15px").append("textarea").attr("x","10px").attr("y","10px").style("width",i["annotation"]-20+"px").style("height","50px").style("font-size","12px"),e.each((function(t){d3.select(this).select("textarea").text(t["gestureType"])})),e.selectAll("div.action").append("div").style("position","relative").style("top","25px").html('<button><span class="fa fa-trash"></span></button>'),e.each((function(e){d3.select(this).select("button").on("click",(function(){for(var a=0;a<t.bookmarkData.length;a++)t.bookmarkData[a]["gestureIdx"]==e["gestureIdx"]&&t.bookmarkData.splice(a,1);t.updateBookmark()}))}))};var Et=Pt,Ft=a("4971"),Mt=a.n(Ft),Ct=(a("24df"),{name:"DrawRelation",components:{VueSlider:Mt.a},props:{videoId:String,videoData:Object},data:function(){return{timeMax:1,timeFilter:[0,1],timeMarks:[0,.5,1],timeData:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],numMax:10,numFilter:[1,10],numMarks:[1,5,10],containerId:"relationContainer"}},watch:{videoData:function(t){this.drawRelation.layout(t),this.numMax=this.drawRelation.numMax},timeFilter:function(t){console.log("timeFilter: ",t),o.emitTimeFilter(t)},numFilter:function(t){console.log("numFilter: ",t),o.emitNumFilter(t)}},mounted:function(){this.drawRelation=new Et(this.containerId)}}),At=Ct,Ht=(a("3b4f"),Object(R["a"])(At,kt,Tt,!1,null,null,null)),Rt=Ht.exports,Lt={name:"app",components:{VideoView:_,MatrixView:ut,DynamicView:wt,RelationView:Rt},data:function(){return{videoList:[],videoId:"",videoData:{},startFrame:0,endFrame:0,clusterNum:10}},watch:{},mounted:function(){var t=this;this.$nextTick((function(){o.onSelectVideo((function(e){t.videoId=e;var a="/data/".concat(e,".json");console.log("dataPath: ",a),d3.json(a).then((function(e){t.videoData=e}))}))}))}},_t=Lt,Ot=(a("034f"),Object(R["a"])(_t,n,r,!1,null,null,null)),Nt=Ot.exports,Vt=a("f206"),Wt=a.n(Vt),$t=(a("4989"),a("ab8b"),a("4bcc"),a("7f10"),a("2ef0")),Yt=a.n($t),Xt=a("5698"),Ut=a("1157"),Gt=a.n(Ut);i["default"].use(Wt.a),window._=Yt.a,window.d3=Xt,window.$=Gt.a,i["default"].config.productionTip=!1,new i["default"]({render:function(t){return t(Nt)}}).$mount("#app")},"85ec":function(t,e,a){},aacf:function(t,e,a){"use strict";var i=a("16b7"),n=a.n(i);n.a},ad17:function(t,e,a){"use strict";var i=a("2e8d"),n=a.n(i);n.a},b886:function(t,e,a){},c6b8:function(t,e,a){}});
//# sourceMappingURL=app.40b5f52c.js.map